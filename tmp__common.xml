<?xml version="1.0" encoding="UTF-8"?><XI3uWnd debug="1">
	
	<EventHandlers>
		<EventHandler Event="ReceivedCall('%{callerid}')">
		<assign name="contact.TB_mobile" expr="%{callerid}"/>
		<assign name="contact.TB_callid" expr="%{input}"/>
		<DbDetails><Where>where base_mobil='%{contact.TB_mobile}' or base_phone='%{contact.TB_mobile}'</Where></DbDetails><submit next="contact.ContactList" namelist="DbDetails" method="post"/>
		</EventHandler>
		<EventHandler Handler="(contact.TB_callid)SetText(%{input});" Event="CallAlerting('%{input}')"/>
		<EventHandler Event="CallDisconnected()"><assign name="topmost" expr="nis3ucs:USS|b"/>
		</EventHandler>
	</EventHandlers>
	
	
	<Language xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\lan\general.xml" name="general">
<Lang name="address" value="地址"/>
<Lang name="location" value="定位"/>
<Lang name="remark" value="备注"/>
<Lang name="basic" value="基本"/>
<Lang name="import" value="导入"/>
<Lang name="export" value="导出"/>
<Lang name="operation" value="操作"/>
<Lang name="create" value="新增"/>
<Lang name="modify" value="修改"/>
<Lang name="reset" value="复位"/>
<Lang name="delete" value="删除"/>
<Lang name="refresh" value="刷新"/>
<Lang name="firstpage" value="首页"/>
<Lang name="prepage" value="上页"/>
<Lang name="nextpage" value="下页"/>
<Lang name="operator" value="操作"/>
<Lang name="gsearch" value="搜索"/>
<Lang name="search" value="搜索"/>
<Lang name="initial" value="初始"/>
<Lang name="addone" value="添加"/>
<Lang name="view" value="查看"/>
<Lang name="submit" value="提交"/>
<Lang name="approval_diagram" value="审批流图"/>
<Lang name="ttp_addone" value="打开新建页面添加新项目"/>
<Lang name="records" value="记录数"/>
<Lang name="ttp_records" value="记录数"/>
<Lang name="ttp_pgs" value="总页数"/>
<Lang name="ttp_pgcur" value="当前页"/>
<Lang name="go2page" value="跳转"/>
<Lang name="modify" value="修改"/>
<Lang name="save" value="保存"/>
<Lang name="id_comm" value="小区"/>
<Lang name="ttp_id_comm" value=""/>
<Lang name="id_build" value="楼宇"/>
<Lang name="ttp_id_build" value=""/>
<Lang name="id_room" value="房号"/>
<Lang name="ttp_id_room" value=""/>
<Lang name="icon_addone" value="fas fa-plus"/>
<Lang name="icon_reset" value="fas fa-eraser"/>
<Lang name="icon_search" value="fas fa-search"/>
<Lang name="icon_create" value="fas fa-save"/>lni-add-files fa-file-medical  
<Lang name="icon_modify" value="fas fa-edit"/>fa
<Lang name="icon_go2Page" value="fas fa-directions"/>
<Lang name="icon_initial" value="fab fa-first-order"/>
<Lang name="icon_firstpage" value="fas fa-step-backward"/>
<Lang name="icon_prepage" value="fas fa-angle-double-left"/>
<Lang name="icon_nextpage" value="fas fa-angle-double-right"/>
<Lang name="icon_endpage" value="fas fa-step-forward"/>
<Lang name="icon_delete" value="fas fa-times"/>
<Lang name="icon_light" value="far fa-lightbulb"/>
</Language>
	<WndTaps>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_Vm.xml" Text="ctu_hotels_v" Name="ctu_hotels_v">
	<var name="hotelonlys" expr="1"/>
	<var name="user_id_cur" expr=""/>
<WndTaps>
<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_Vem.xml" Text="ctu_hotels" Name="ctu_hotels" popup="1" Ver="2">
<var name="refreshAfterEdit" expr="0"/>
<var name="dataRequired" expr="hotelname"/>
<var name="dataRequireless" expr=""/>
<Language xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\lan\ctu_hotels.xml" name="ctu_hotels">
<Lang name="ctu_hotels" value="ctu_hotels"/>
<Lang name="hotelname" value=""/>
<Lang name="ttp_hotelname" value=""/>
<Lang name="address" value=""/>
<Lang name="ttp_address" value=""/>
<Lang name="hotel_id" value=""/>
<Lang name="ttp_hotel_id" value=""/>
<Lang name="url" value=""/>
<Lang name="ttp_url" value=""/>
<Lang name="phone" value=""/>
<Lang name="ttp_phone" value=""/>
<Lang name="mobile" value=""/>
<Lang name="ttp_mobile" value=""/>
<Lang name="qq" value=""/>
<Lang name="ttp_qq" value=""/>
<Lang name="star" value=""/>
<Lang name="ttp_star" value=""/>
<Lang name="traffic" value=""/>
<Lang name="ttp_traffic" value=""/>
<Lang name="content" value=""/>
<Lang name="ttp_content" value=""/>
<Lang name="delicacy" value=""/>
<Lang name="ttp_delicacy" value=""/>
<Lang name="service" value=""/>
<Lang name="ttp_service" value=""/>
<Lang name="boss" value=""/>
<Lang name="ttp_boss" value=""/>
<Lang name="canyin" value=""/>
<Lang name="ttp_canyin" value=""/>
<Lang name="email" value=""/>
<Lang name="ttp_email" value=""/>
<Lang name="roomdetails" value=""/>
<Lang name="ttp_roomdetails" value=""/>
<Lang name="opendate" value=""/>
<Lang name="ttp_opendate" value=""/>
<Lang name="decoration" value=""/>
<Lang name="ttp_decoration" value=""/>
<Lang name="picture" value=""/>
<Lang name="ttp_picture" value=""/>
<Lang name="album" value=""/>
<Lang name="ttp_album" value=""/>
<Lang name="cityid" value=""/>
<Lang name="ttp_cityid" value=""/>
<Lang name="cityname" value=""/>
<Lang name="ttp_cityname" value=""/>
<Lang name="manager_id" value=""/>
<Lang name="ttp_manager_id" value="user id from user table"/>
<Lang name="manager" value=""/>
<Lang name="ttp_manager" value=""/>
<Lang name="cbd_id" value=""/>
<Lang name="ttp_cbd_id" value=""/>
<Lang name="cbd_name" value=""/>
<Lang name="ttp_cbd_name" value=""/>
<Lang name="chain_name" value=""/>
<Lang name="ttp_chain_name" value=""/>
<Lang name="chain_id" value=""/>
<Lang name="ttp_chain_id" value=""/>
<Lang name="mappoint" value=""/>
<Lang name="ttp_mappoint" value=""/>
<Lang name="scenic" value=""/>
<Lang name="ttp_scenic" value=""/>
<Lang name="specialty" value=""/>
<Lang name="ttp_specialty" value=""/>
<Lang name="tags" value=""/>
<Lang name="ttp_tags" value=""/>
<Lang name="remark" value=""/>
<Lang name="ttp_remark" value=""/>
<Lang name="uptime" value=""/>
<Lang name="ttp_uptime" value="酒店更新时间"/>
<Lang name="actived" value=""/>
<Lang name="ttp_actived" value=""/>
<Lang name="contactinfo" value=""/>
<Lang name="ttp_contactinfo" value=""/>
<Lang name="pubphones" value=""/>
<Lang name="ttp_pubphones" value=""/>
<Lang name="auditing" value=""/>
<Lang name="ttp_auditing" value=""/>
<Lang name="min_price" value=""/>
<Lang name="ttp_min_price" value=""/>
<Lang name="max_price" value=""/>
<Lang name="ttp_max_price" value=""/>
<Lang name="px_comment" value=""/>
<Lang name="ttp_px_comment" value=""/>
<Lang name="px_commend" value=""/>
<Lang name="ttp_px_commend" value=""/>
<Lang name="x" value=""/>
<Lang name="ttp_x" value=""/>
<Lang name="y" value=""/>
<Lang name="ttp_y" value=""/>
<Lang name="hotelpictures" value=""/>
<Lang name="ttp_hotelpictures" value=""/>
<Lang name="nearbyhotels" value=""/>
<Lang name="ttp_nearbyhotels" value=""/>
<Lang name="nearbypoints" value=""/>
<Lang name="ttp_nearbypoints" value=""/>
<Lang name="px_hot" value=""/>
<Lang name="ttp_px_hot" value=""/>
<Lang name="px_index" value=""/>
<Lang name="ttp_px_index" value=""/>
<Lang name="bedprice" value=""/>
<Lang name="ttp_bedprice" value=""/>
<Lang name="ttp_operationctu_hotels" value="操作"/>
<Lang name="ttp_createctu_hotels" value="新增"/>
<Lang name="ttp_modifyctu_hotels" value="修改"/>
<Lang name="ttp_deletectu_hotels" value="删除"/>
<Lang name="ttp_refreshctu_hotels" value="刷新"/>
<Lang name="operation" value="操作"/>
<Lang name="create" value="新增"/>
<Lang name="modify" value="修改"/>
<Lang name="delete" value="删除"/>
<Lang name="refresh" value="刷新"/>
<Lang name="firstpage" value="首页"/>
<Lang name="prepage" value="上页"/>
<Lang name="nextpage" value="下页"/>
</Language>
<Ctrls>
<GroupBox Text="ctu_hotels" Name="GBctu_hotels" id="ctu_hotels" Size="100,100"><Ctrls>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_GBDEDIT.xml" Name="GBDEDITctu_hotels"><Ctrls>
<GroupBox feature="tab" Text="BasicInfo" Name="BasicInfo"><Ctrls>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_hotelname"><Ctrls>
<Label Align="Right" Text="hotelname" Name="lb_hotelname" Size="60,20"/>
<TextBox Weight="150" Text="" ToolTip="ttp_hotelname" Name="hotelname" Size="150,20"/>
<MagicCtrl ToolTip="DialToCall" Name="dialhotelname" OnClick="nis3ucs:%{hotelname}" images=" ,data/startcall_green.png" button="type:0" Size="20,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_mobile"><Ctrls>
<Label Align="Right" Text="mobile" Name="lb_mobile" Size="60,20"/>
<TextBox Weight="150" Text="" ToolTip="ttp_mobile" Name="mobile" Size="150,20"/>
<MagicCtrl ToolTip="DialToCall" Name="dialmobile" OnClick="nis3ucs:%{mobile}" images=" ,data/startcall_green.png" button="type:0" Size="20,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_phone"><Ctrls>
<Label Align="Right" Text="phone" Name="lb_phone" Size="60,20"/>
<TextBox Weight="150" Text="" ToolTip="ttp_phone" Name="phone" Size="150,20"/>
<MagicCtrl ToolTip="DialToCall" Name="dialphone" OnClick="nis3ucs:%{phone}" images=" ,data/startcall_green.png" button="type:0" Size="20,20"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_cityname"><Ctrls>
<Label Align="Right" Text="cityname" Name="lb_cityname" readonly="true" Size="60,20"/>
<TextBox Weight="150" Text="" ToolTip="ttp_cityname" Name="cityname" readonly="true" Size="150,20">
	<DbDetails>
<Index>city_code</Index>
<DbTable>creator.ctu_city</DbTable>
<Data>city_name,city_code</Data>
<Where/>
<queryFormat/></DbDetails><OnEnChange><if cond="%{cityname[city_code]}"><assign name="cityid" expr="%{cityname[city_code]}"/></if></OnEnChange></TextBox>
<MagicCtrl Name="pickcityname" Link="tip:Pick" images=",data/search.png" button="type:0" Size="20,20"><OnClick><assign name="$parent.citypick.frmwndctrl" expr="ctu_hotels.cityname"/></OnClick></MagicCtrl>\r\n</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_cityid" Visible="false"><Ctrls>
<Label Align="Right" Text="cityid" overlap="pre" Name="lb_cityid" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_cityid" overlap="pre" Name="cityid" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_address"><Ctrls>
<Label Align="Right" Text="address" Name="lb_address" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_address" Name="address" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_email"><Ctrls>
<Label Align="Right" Text="email" Name="lb_email" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_email" Name="email" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_opendate" Visible="false"><Ctrls>
<Label Align="Right" Text="opendate" overlap="pre" Name="lb_opendate" readonly="true" Size="60,20" Visible="false"/>
<DateTime Weight="170" Text="" ToolTip="ttp_opendate" overlap="pre" Name="opendate" readonly="true" Size="170,20" Visible="false" Format="yyyy-MM-dd HH:mm:ss"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_url"><Ctrls>
<Label Align="Right" Text="url" Name="lb_url" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_url" Name="url" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_qq"><Ctrls>
<Label Align="Right" Text="qq" Name="lb_qq" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_qq" Name="qq" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_star"><Ctrls>
<Label Align="Right" Text="star" Name="lb_star" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_star" Name="star" Size="170,20"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_manager_id"><Ctrls>
<Label Align="Right" Text="manager_id" onload="init" Name="lb_manager_id" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_manager_id" onload="init" Name="manager_id" Size="170,100">
	<DbDetails>
<Index>user_id</Index>
<DbTable>creator.ctu_user</DbTable>
<Data>user_name,user_id</Data>
<Where>1</Where>
<queryFormat>select %{data} from %{dbtable} where %{where} limit %{StartRow},35</queryFormat></DbDetails></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_manager" Visible="false"><Ctrls>
<Label Align="Right" Text="manager" overlap="pre" Name="lb_manager" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_manager" overlap="pre" Name="manager" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_chain_name" Visible="false"><Ctrls>
<Label Align="Right" Text="chain_name" overlap="pre" Name="lb_chain_name" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_chain_name" overlap="pre" Name="chain_name" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_chain_id"><Ctrls>
<Label Align="Right" Text="chain_id" onload="init" Name="lb_chain_id" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_chain_id" onload="init" Name="chain_id" Size="170,100">
	<DbDetails fcsm="true">
<Index>chain_id</Index>
<DbTable>creator.ctu_chainbrand</DbTable>
<Data>chain_name_cn chain_name,chain_id</Data>
<Where/>
<queryFormat/></DbDetails></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_picture"><Ctrls>
<Label Align="Right" Text="picture" Name="lb_picture" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_picture" Name="picture" Size="170,20"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_album"><Ctrls>
<Label Align="Right" Text="album" Name="lb_album" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_album" Name="album" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_mappoint"><Ctrls>
<Label Align="Right" Text="mappoint" Name="lb_mappoint" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_mappoint" Name="mappoint" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_min_price" Visible="false"><Ctrls>
<Label Align="Right" Text="min_price" overlap="pre" Name="lb_min_price" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_min_price" overlap="pre" Name="min_price" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_max_price" Visible="false"><Ctrls>
<Label Align="Right" Text="max_price" overlap="pre" Name="lb_max_price" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_max_price" overlap="pre" Name="max_price" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_uptime" Visible="false"><Ctrls>
<Label Align="Right" Text="uptime" overlap="pre" Name="lb_uptime" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_uptime" overlap="pre" Name="uptime" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_tags"><Ctrls>
<Label Align="Right" Text="tags" Name="lb_tags" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_tags" Name="tags" Size="170,20"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_actived"><Ctrls>
<CheckBox Text="actived" ToolTip="ttp_actived" Name="actived" Size="230,20" checked="true"/>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
<BR NULLHeight="1"/><GroupBox feature="tab" Text="Info2" Name="Info2"><Ctrls>
<GroupBox cols="xs12" Multiline="0" Name="GB_traffic"><Ctrls>
<Label Align="Right" Text="traffic" Name="lb_traffic" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_traffic" Name="traffic" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_pubphones"><Ctrls>
<Label Align="Right" Text="pubphones" Name="lb_pubphones" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_pubphones" Name="pubphones" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_contactinfo"><Ctrls>
<Label Align="Right" Text="contactinfo" Name="lb_contactinfo" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_contactinfo" Name="contactinfo" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_content"><Ctrls>
<Label Align="Right" Text="content" Name="lb_content" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_content" Name="content" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_delicacy"><Ctrls>
<Label Align="Right" Text="delicacy" Name="lb_delicacy" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_delicacy" Name="delicacy" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_service"><Ctrls>
<Label Align="Right" Text="service" Name="lb_service" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_service" Name="service" Size="630,50"/>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
<BR NULLHeight="1"/><GroupBox feature="tab" Text="Info3" Name="Info3"><Ctrls>
<GroupBox cols="xs12" Multiline="0" Name="GB_boss"><Ctrls>
<Label Align="Right" Text="boss" Name="lb_boss" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_boss" Name="boss" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_canyin"><Ctrls>
<Label Align="Right" Text="canyin" Name="lb_canyin" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_canyin" Name="canyin" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_roomdetails"><Ctrls>
<Label Align="Right" Text="roomdetails" Name="lb_roomdetails" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_roomdetails" Name="roomdetails" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_decoration"><Ctrls>
<Label Align="Right" Text="decoration" Name="lb_decoration" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_decoration" Name="decoration" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_nearbyhotels"><Ctrls>
<Label Align="Right" Text="nearbyhotels" Name="lb_nearbyhotels" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_nearbyhotels" Name="nearbyhotels" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_nearbypoints"><Ctrls>
<Label Align="Right" Text="nearbypoints" Name="lb_nearbypoints" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_nearbypoints" Name="nearbypoints" Size="630,50"/>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
<BR NULLHeight="1"/><GroupBox feature="tab" Text="Info4" Name="Info4"><Ctrls>
<GroupBox cols="xs12" Multiline="0" Name="GB_scenic"><Ctrls>
<Label Align="Right" Text="scenic" Name="lb_scenic" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_scenic" Name="scenic" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_bedprice"><Ctrls>
<Label Align="Right" Text="bedprice" Name="lb_bedprice" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_bedprice" Name="bedprice" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_specialty"><Ctrls>
<Label Align="Right" Text="specialty" Name="lb_specialty" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_specialty" Name="specialty" Size="630,50"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12" Multiline="0" Name="GB_remark"><Ctrls>
<Label Align="Right" Text="remark" Name="lb_remark" Size="60,50"/>
<TextBox Weight="630" Text="" ToolTip="ttp_remark" Name="remark" Size="630,50"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_hotel_id" Visible="false"><Ctrls>
<Label Align="Right" Text="hotel_id" overlap="pre" Name="lb_hotel_id" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="150" Text="" ToolTip="ttp_hotel_id" overlap="pre" Name="hotel_id" readonly="true" Size="150,20" Visible="false"><OnEnChange><if cond="'%{hotel_id}'"><SetVisible name="insertctu_hotels" Visible="0"/><SetVisible name="modifyctu_hotels" Visible="1"/><else/><SetVisible name="insertctu_hotels" Visible="1"/><SetVisible name="modifyctu_hotels" Visible="0"/></if></OnEnChange></TextBox>
<MagicCtrl ToolTip="DialToCall" Name="dialhotel_id" OnClick="nis3ucs:%{hotel_id}" images=" ,data/startcall_green.png" button="type:0" Size="20,20"/>
</Ctrls></GroupBox>
</Ctrls></GroupBox></Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_GBOPEm.xml" cols="xs12 sm12 md12 lg12" Name="GBOPEctu_hotels" Size="100,100"><Ctrls>
<Button sqlpkinsert="hotel_id" Text="create" ToolTip="ttp_createctu_hotels" Name="insertctu_hotels" Size="50,20">
	<OnClick>
	<DbDetails fcsm="1">
<DbTable>creator.ctu_hotels</DbTable>
<Required>%{dataRequired}</Required>
<Requireless>%{dataRequireless}</Requireless>
<Data>hotelname,email,opendate,address,url,phone,mobile,qq,star,cityid[city_code],manager,chain_name,chain_id[chain_id],picture,album,mappoint,traffic,pubphones,contactinfo,content,delicacy,service,boss,canyin,roomdetails,decoration,nearbyhotels,nearbypoints,scenic,bedprice,specialty,remark,tags,actived</Data>
<DataEx>cityname,manager_id,uptime;'%{cityid[city_name]}','%{manager_id[user_name]}',UNIX_TIMESTAMP()</DataEx>
<queryFormat>insert into %{table} %{data}</queryFormat></DbDetails>
	<submit namelist="DbDetails"/><if cond="%{refreshAfterEdit}"><submit next="ctu_hotelsLst"/></if>
	</OnClick>
	</Button><TAB/>
<Button Text="modify" ToolTip="ttp_modifyctu_hotels" Name="modifyctu_hotels" Size="50,20">
			  <OnClick>
	<DbDetails fcsm="1">
<DbTable>creator.ctu_hotels</DbTable>
<Required>%{dataRequired}</Required>
<Requireless>%{dataRequireless}</Requireless>
<Data>hotelname,email,opendate,address,url,phone,mobile,qq,star,manager,chain_name,chain_id[chain_id],picture,album,mappoint,traffic,pubphones,contactinfo,content,delicacy,service,boss,canyin,roomdetails,decoration,nearbyhotels,nearbypoints,scenic,bedprice,specialty,remark,tags,actived</Data>
<DataEx>manager_id,uptime;'%{manager_id[user_name]}',UNIX_TIMESTAMP()</DataEx>
<Where>hotel_id='%{hotel_id}'</Where>
<queryFormat>update %{table} set cityid=if('%{cityid[city_code]}','%{cityid[city_code]}',cityid),cityname=if('%{cityid[city_code]}','%{cityid[city_name]}',cityname),%{data} where %{where}</queryFormat></DbDetails>
	<submit namelist="DbDetails"/><if cond="%{refreshAfterEdit}"><submit next="ctu_hotelsLst"/></if>
	</OnClick>
	</Button><TAB/>
<Button Text="reset" ToolTip="ttp_resetctu_hotels" Name="resetctu_hotels" Size="50,20">
	<OnClick>
	<submit next="GBDEDITctu_hotels" function="reset"/>
	</OnClick>
	</Button><TAB/>
<Button Text="gsearch" ToolTip="ttp_gsearchctu_hotels" Name="gsearchctu_hotels" Size="50,20" visible="false">
			  <OnClick>
	<search next="ctu_hotelsLst" listed="0" prefixwhere="0" inputed="1"><zone_id op="(" ref=""/></search><submit next="GBDEDITctu_hotels" namelist="search" function="search"/>
	</OnClick>
	</Button><TAB/>
</Ctrls></GroupBox>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_Vh.xml" cols="xs12 sm12 md12 lg12" Name="GBDVctu_hotels" visible="0"><Ctrls>
<ListCtrl loadedclick="1" ToolTip="ttp_ctu_hotels" Name="ctu_hotelsLst" Size="70,20" visible="0">
	<DbDetails fcsm="1">
<Index>hotel_id</Index>
<DbTable>creator.ctu_hotels</DbTable>
<Data>hotelname,mobile,phone,cityname,cityid,address,email,opendate,url,qq,star,manager_id,manager,chain_name,chain_id,picture,album,mappoint,min_price,max_price,uptime,tags,actived,traffic,pubphones,contactinfo,content,delicacy,service,boss,canyin,roomdetails,decoration,nearbyhotels,nearbypoints,scenic,bedprice,specialty,remark,hotel_id</Data>
<Order>hotel_id</Order></DbDetails>
<OnClick><assign name="cityname[city_code]" function="SetSel" expr="%{ctu_hotelsLst[cityname]}"/><assign name="manager_id[user_id]" function="SetSel" expr="%{ctu_hotelsLst[manager_id]}"/><assign name="chain_id[chain_id]" function="SetSel" expr="%{ctu_hotelsLst[chain_id]}"/>
<if cond="'%{hotel_id}'"><SetVisible name="insertctu_hotels" Visible="0"/><SetVisible name="modifyctu_hotels" Visible="1"/></if>
</OnClick>
</ListCtrl>
</Ctrls></GroupBox></Ctrls></GroupBox></Ctrls>
	<OnChanged/>
	<OnActivate><SetVisible name="insertctu_hotels" Visible="1"/><SetVisible name="modifyctu_hotels" Visible="0"/></OnActivate>
</WndTap>
<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\city_pick.xml" Text="CityPick" Name="CityPick" popup="1" Ver="2">
<Ctrls>
<GroupBox Text="ctu_city" Name="GBctu_city" id="ctu_city" Size="100,100"><Ctrls>
<GroupBox Name="GBDEDITctu_city"><Ctrls>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_city"><Ctrls>
	<ComboBox Weight="230" OnLoad="init" Name="provinces" Size="230,200" Type="3" SelectedIndex="-1">
		<DbDetails>
		<queryFormat>select province_name,province_code from creator.ctu_province</queryFormat> 
		</DbDetails>
		<OnSELENDOK><if cond="%{provinces[province_code]}">
			<DbDetails>
			<queryFormat>select city_name,city_code from creator.ctu_city where city_province_code=%{provinces[province_code]} and city_area_code=0</queryFormat> 
			</DbDetails>
			<submit next="areas" namelist="DbDetails" method="post"/>
			<else/><submit next="areas" function="resetcontent"/>
			</if></OnSELENDOK>
	</ComboBox>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_city"><Ctrls>
	<ComboBox Weight="230" Name="areas" Size="230,200" Type="3" SelectedIndex="-1">
		<OnSELENDOK><if cond="%{areas[city_code]}">
			<DbDetails>
			<queryFormat>select city_name,city_code from creator.ctu_city where city_area_code=%{areas[city_code]}</queryFormat> 
			</DbDetails>
			<submit next="citys" namelist="DbDetails" method="post"/>
			<else/><submit next="citys" function="resetcontent"/>
			</if></OnSELENDOK>
	</ComboBox>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_city"><Ctrls>
	<ComboBox Weight="230" Name="citys" Size="230,300" Type="3" SelectedIndex="-1">
		<OnSELENDOK>
			<if cond="%{citys}"><assign name="TB_addr" expr="%{provinces}%{citys}"/><DbDetails><Where>city_code='%{citys[city_code]}'</Where></DbDetails><submit next="$parent.%{frmwndctrl}" namelist="DbDetails"/><assign name="$parent.%{frmwndctrl}[selectedindex]" function="SetSel" expr="0"/><submit function="onok"/></if>
				</OnSELENDOK></ComboBox>
</Ctrls></GroupBox>
	</Ctrls></GroupBox>
	</Ctrls></GroupBox>
	</Ctrls>
	<OnChanged/>
	<OnActivate/>
	</WndTap>
</WndTaps>
<var name="searchtmpl"><hotelname format="(c.hotelname like '%%{opvalue}%')"/><mobile format="(c.mobile like '%%{opvalue}%')"/><phone format="(c.phone like '%%{opvalue}%')"/><cityname format="(c.cityid like '%%{opvalue}%')"/><cityid format="(c.cityid like '%%{opvalue}%')"/><address format="(c.address like '%%{opvalue}%')"/><email format="(c.email like '%%{opvalue}%')"/><opendate format="(c.opendate between '%{opendate[datetime]}' and '%{opendate[datetime2]}')"/><url format="(c.url like '%%{opvalue}%')"/><qq format="(c.qq like '%%{opvalue}%')"/><star format="(c.star like '%%{opvalue}%')"/><manager_id format="c.manager_id='%{opvalue}'"/><manager format="(c.manager like '%%{opvalue}%')"/><chain_name format="(c.chain_name like '%%{opvalue}%')"/><chain_id format="c.chain_id='%{opvalue}'"/><picture format="(c.picture like '%%{opvalue}%')"/><album format="(c.album like '%%{opvalue}%')"/><mappoint format="(c.mappoint like '%%{opvalue}%')"/><min_price format="(c.min_price like '%%{opvalue}%')"/><max_price format="(c.max_price like '%%{opvalue}%')"/><uptime format="(c.uptime like '%%{opvalue}%')"/><tags format="(c.tags like '%%{opvalue}%')"/><actived format="c.actived is %{opvalue}"/><traffic format="(c.traffic like '%%{opvalue}%')"/><pubphones format="(c.pubphones like '%%{opvalue}%')"/><contactinfo format="(c.contactinfo like '%%{opvalue}%')"/><content format="(c.content like '%%{opvalue}%')"/><delicacy format="(c.delicacy like '%%{opvalue}%')"/><service format="(c.service like '%%{opvalue}%')"/><boss format="(c.boss like '%%{opvalue}%')"/><canyin format="(c.canyin like '%%{opvalue}%')"/><roomdetails format="(c.roomdetails like '%%{opvalue}%')"/><decoration format="(c.decoration like '%%{opvalue}%')"/><nearbyhotels format="(c.nearbyhotels like '%%{opvalue}%')"/><nearbypoints format="(c.nearbypoints like '%%{opvalue}%')"/><scenic format="(c.scenic like '%%{opvalue}%')"/><bedprice format="(c.bedprice like '%%{opvalue}%')"/><specialty format="(c.specialty like '%%{opvalue}%')"/><remark format="(c.remark like '%%{opvalue}%')"/><hotel_id format="(c.hotel_id like '%%{opvalue}%')"/></var>
<Language xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\lan\ctu_hotels.xml" name="ctu_hotels">
<Lang name="ctu_hotels" value="ctu_hotels"/>
<Lang name="hotelname" value=""/>
<Lang name="ttp_hotelname" value=""/>
<Lang name="address" value=""/>
<Lang name="ttp_address" value=""/>
<Lang name="hotel_id" value=""/>
<Lang name="ttp_hotel_id" value=""/>
<Lang name="url" value=""/>
<Lang name="ttp_url" value=""/>
<Lang name="phone" value=""/>
<Lang name="ttp_phone" value=""/>
<Lang name="mobile" value=""/>
<Lang name="ttp_mobile" value=""/>
<Lang name="qq" value=""/>
<Lang name="ttp_qq" value=""/>
<Lang name="star" value=""/>
<Lang name="ttp_star" value=""/>
<Lang name="traffic" value=""/>
<Lang name="ttp_traffic" value=""/>
<Lang name="content" value=""/>
<Lang name="ttp_content" value=""/>
<Lang name="delicacy" value=""/>
<Lang name="ttp_delicacy" value=""/>
<Lang name="service" value=""/>
<Lang name="ttp_service" value=""/>
<Lang name="boss" value=""/>
<Lang name="ttp_boss" value=""/>
<Lang name="canyin" value=""/>
<Lang name="ttp_canyin" value=""/>
<Lang name="email" value=""/>
<Lang name="ttp_email" value=""/>
<Lang name="roomdetails" value=""/>
<Lang name="ttp_roomdetails" value=""/>
<Lang name="opendate" value=""/>
<Lang name="ttp_opendate" value=""/>
<Lang name="decoration" value=""/>
<Lang name="ttp_decoration" value=""/>
<Lang name="picture" value=""/>
<Lang name="ttp_picture" value=""/>
<Lang name="album" value=""/>
<Lang name="ttp_album" value=""/>
<Lang name="cityid" value=""/>
<Lang name="ttp_cityid" value=""/>
<Lang name="cityname" value=""/>
<Lang name="ttp_cityname" value=""/>
<Lang name="manager_id" value=""/>
<Lang name="ttp_manager_id" value="user id from user table"/>
<Lang name="manager" value=""/>
<Lang name="ttp_manager" value=""/>
<Lang name="cbd_id" value=""/>
<Lang name="ttp_cbd_id" value=""/>
<Lang name="cbd_name" value=""/>
<Lang name="ttp_cbd_name" value=""/>
<Lang name="chain_name" value=""/>
<Lang name="ttp_chain_name" value=""/>
<Lang name="chain_id" value=""/>
<Lang name="ttp_chain_id" value=""/>
<Lang name="mappoint" value=""/>
<Lang name="ttp_mappoint" value=""/>
<Lang name="scenic" value=""/>
<Lang name="ttp_scenic" value=""/>
<Lang name="specialty" value=""/>
<Lang name="ttp_specialty" value=""/>
<Lang name="tags" value=""/>
<Lang name="ttp_tags" value=""/>
<Lang name="remark" value=""/>
<Lang name="ttp_remark" value=""/>
<Lang name="uptime" value=""/>
<Lang name="ttp_uptime" value="酒店更新时间"/>
<Lang name="actived" value=""/>
<Lang name="ttp_actived" value=""/>
<Lang name="contactinfo" value=""/>
<Lang name="ttp_contactinfo" value=""/>
<Lang name="pubphones" value=""/>
<Lang name="ttp_pubphones" value=""/>
<Lang name="auditing" value=""/>
<Lang name="ttp_auditing" value=""/>
<Lang name="min_price" value=""/>
<Lang name="ttp_min_price" value=""/>
<Lang name="max_price" value=""/>
<Lang name="ttp_max_price" value=""/>
<Lang name="px_comment" value=""/>
<Lang name="ttp_px_comment" value=""/>
<Lang name="px_commend" value=""/>
<Lang name="ttp_px_commend" value=""/>
<Lang name="x" value=""/>
<Lang name="ttp_x" value=""/>
<Lang name="y" value=""/>
<Lang name="ttp_y" value=""/>
<Lang name="hotelpictures" value=""/>
<Lang name="ttp_hotelpictures" value=""/>
<Lang name="nearbyhotels" value=""/>
<Lang name="ttp_nearbyhotels" value=""/>
<Lang name="nearbypoints" value=""/>
<Lang name="ttp_nearbypoints" value=""/>
<Lang name="px_hot" value=""/>
<Lang name="ttp_px_hot" value=""/>
<Lang name="px_index" value=""/>
<Lang name="ttp_px_index" value=""/>
<Lang name="bedprice" value=""/>
<Lang name="ttp_bedprice" value=""/>
<Lang name="ttp_operationctu_hotels" value="操作"/>
<Lang name="ttp_createctu_hotels" value="新增"/>
<Lang name="ttp_modifyctu_hotels" value="修改"/>
<Lang name="ttp_deletectu_hotels" value="删除"/>
<Lang name="ttp_refreshctu_hotels" value="刷新"/>
<Lang name="operation" value="操作"/>
<Lang name="create" value="新增"/>
<Lang name="modify" value="修改"/>
<Lang name="delete" value="删除"/>
<Lang name="refresh" value="刷新"/>
<Lang name="firstpage" value="首页"/>
<Lang name="prepage" value="上页"/>
<Lang name="nextpage" value="下页"/>
</Language>
<Ctrls><GroupBox Text="ctu_hotels" Name="GBctu_hotels" id="ctu_hotels" Size="100,100"><Ctrls>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_Vsm.xml" text="Search" toggle="1" Name="GBDEDITctu_hotels"><Ctrls>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_hotelname"><Ctrls>
<Label Align="Right" Text="hotelname" Name="lb_hotelname" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_hotelname" Name="hotelname" Size="150,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_mobile"><Ctrls>
<Label Align="Right" Text="mobile" Name="lb_mobile" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_mobile" Name="mobile" Size="150,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_cityname"><Ctrls>
<Label Align="Right" Text="cityname" Name="lb_cityname" Size="60,20"/>
<TextBox Weight="150" Text="" ToolTip="ttp_cityname" Name="cityname" Size="150,20">
	<DbDetails>
<Index>city_code</Index>
<DbTable>creator.ctu_city</DbTable>
<Data>city_name,city_code</Data>
<Where/>
<queryFormat/></DbDetails><OnEnChange><if cond="%{cityname[city_code]}"><assign name="cityid" expr="%{cityname[city_code]}"/></if></OnEnChange></TextBox>
<MagicCtrl Name="pickcityname" Link="tip:Pick" images=",data/search.png" button="type:0" Size="20,20"><OnClick><assign name="$this.citypick.frmwndctrl" expr="cityname"/></OnClick></MagicCtrl>\r\n</Ctrls></GroupBox>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Name="GBOPVctu_hotels" Size="100,20"><Ctrls>
<Button Text="addone" ToolTip="ttp_addone" Name="addone" Size="50,20">	<OnClick><submit next="$this.ctu_hotels.GBDEDITctu_hotels" function="reset"/><assign name="$this.ctu_hotels.frmwndctrl" expr="%{$this.ctu_hotels_vLst}"/></OnClick>	</Button><TAB/>	
<Button Text="reset" ToolTip="ttp_resetctu_hotels" Name="resetctu_hotels" Size="50,20">	<OnClick>	<submit next="GBDEDITctu_hotels" function="reset"/>	</OnClick>	</Button><TAB/>	
<Button Text="Search" ToolTip="ttp_gsearchctu_hotels" Name="gsearchctu_hotels" Size="50,20">	<OnClick>	
<search next="ctu_hotels_vLst" listed="0" prefixwhere="0" prefixand="1" inputed="1">%{searchtmpl}</search><submit next="GBDEDITctu_hotels" namelist="search" function="search"/>	
<search next="records_ctu_hotels" listed="0" prefixwhere="0" prefixand="1" inputed="1">%{searchtmpl}</search><submit next="GBDEDITctu_hotels" namelist="search" function="search"/>	
</OnClick></Button><TAB/></Ctrls></GroupBox>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_Vpg.xml" cols="xs12 sm6 md4" Multiline="0" Name="GBPGctu_hotels"><Ctrls>
<Label Align="Right" Text="Records" Name="lb_Records" Size="60,20"/>
<TextBox Weight="30" ToolTip="ttp_records" OnLoad="init" Name="records_ctu_hotels" readonly="1" Size="40,20">
	<DbDetails fcsm="1">
<Index>hotel_id</Index>
<DbTable>creator.ctu_hotels c left join creator.ctu_city c0 on c.cityname=c0.city_code left join creator.ctu_user c1 on c.manager_id=c1.user_id left join creator.ctu_chainbrand c2 on c.chain_id=c2.chain_id</DbTable>
<Data>count(*) records</Data>
<Order>hotel_id</Order><Queryformat>select %{data} from (select c.hotel_id from %{dbtable} where %{hotelonlys} %{where} GROUP BY c.hotel_id  ORDER BY c.hotel_id) t</Queryformat></DbDetails>
<OnEnchange>
<assign name="pgs_ctu_hotels" expr="js(Math.ceil(%{records_ctu_hotels}/%{ctu_hotels_vLst[countsperpage]}))"/>
<assign name="pgscb_ctu_hotels" function="setitems" expr="js('1~'+Math.ceil(%{records_ctu_hotels}/%{ctu_hotels_vLst[countsperpage]}))"/>
</OnEnchange>
</TextBox>

<TextBox Weight="30" ToolTip="ttp_pgs" Name="pgs_ctu_hotels" readonly="1" Size="30,20"/>
<TextBox Weight="30" ToolTip="ttp_pgcur" Name="pgcur_ctu_hotels" Size="30,20"/>
<Button Text="go2Page" Name="go2pagectu_hotels_vLst" Size="50,20"><OnClick><submit next="ctu_hotels_vLst" function="GetPage(%{pgcur_ctu_hotels}-1)"/></OnClick></Button>
</Ctrls></GroupBox>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_Vpgop.xml" cols="xs12 sm6 md4" Name="GBOPVctu_hotels"><Ctrls>
<TAB/><Button Text="initial" ToolTip="ttp_initial" Name="initialctu_hotels" Size="50,20">
<OnClick><submit next="ctu_hotels_vLst" function="initial"/><submit next="records_ctu_hotels" function="initial"/></OnClick></Button>
<TAB/><Button Text="firstpage" Name="FPctu_hotels_vLst" Size="50,20">
<OnClick><submit next="ctu_hotels_vLst" function="GetPage(first)"/><submit next="records_ctu_hotels"/></OnClick></Button>
<Button Text="prepage" Name="PREctu_hotels_vLst" Size="50,20">
<OnClick><submit next="ctu_hotels_vLst" function="GetPage(Pre)"/></OnClick></Button>
<Button Text="nextpage" Name="NPctu_hotels_vLst" Size="50,20">
<OnClick><submit next="ctu_hotels_vLst" function="GetPage(Next)"/></OnClick></Button>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_hotels_Vvm.xml" cols="xs12 sm12 md12 lg12" Name="GBDVctu_hotels"><Ctrls>
<ListCtrl Heading="hotelname,640;cityid,120;cityname,100;email,500;opendate,150;address,500;url,100;phone,500;mobile,500;qq,100;star,30;manager_id,120;manager,175;chain_name,250;chain_id,120;picture,55;album,55;mappoint,500;min_price,55;max_price,55;tags,640;uptime,55;actived,60;hotel_id,55;" loadedclick="0" ToolTip="ttp_ctu_hotels" OnLoad="init" Name="ctu_hotels_vLst" Size="700,420">
	<DbDetails>
<DbTable>creator.ctu_hotels c left join creator.ctu_city c0 on c.cityid=c0.city_code left join creator.ctu_user c1 on c.manager_id=c1.user_id left join creator.ctu_chainbrand c2 on c.chain_id=c2.chain_id</DbTable>
<Index>hotel_id</Index>
<Data>c.hotelname,c0.city_name cityid,c.cityname,c.email,c.opendate,c.address,c.url,c.phone,c.mobile,c.qq,c.star,c1.user_name manager_id,c.manager,c.chain_name,c2.chain_name_cn chain_id,c.picture,c.album,c.mappoint,c.min_price,c.max_price,c.tags,c.uptime,c.actived,c.hotel_id</Data>
<Order>hotel_id</Order>
<queryFormat xml:base="D:\3UCS\3UCS Server\layout\biztools\mysqlcfg.xml" id="tbpages">select %{data} from %{dbtable} where %{hotelonlys} %{where} order by %{order} limit %{StartRow},%{PgSize}</queryFormat></DbDetails>
<operator firstpage="1" nextpage="1" refresh="1" prepage="1">
<op text="modify"><DbDetails><Where>hotel_id='%{ctu_hotels_vLst[hotel_id]}'</Where></DbDetails><submit next="$this.ctu_hotels.ctu_hotelsLst" namelist="DbDetails"/></op>
<op text="pano"><assign name="ctu_pano_v.ctu_pano.reftbl" function="setsel" expr="hotels"/><assign name="ctu_pano_v.ctu_pano.refkey" function="setsel" expr="hotel_id"/><assign name="ctu_pano_v.ctu_pano.refid" expr="%{ctu_hotels_vLst[hotel_id]}"/></op>
<op text="panos"><DbDetails><Where>where reftbl='hotels' and refkey='hotel_id' and refid='%{ctu_hotels_vLst[hotel_id]}'</Where></DbDetails><submit next="ctu_pano_v.ctu_pano_vLst" namelist="DbDetails"/></op>
<op text="delete" needconfirm="1"><DbDetails>
<DbTable>creator.ctu_hotels</DbTable>
<Where>hotel_id='%{ctu_hotels_vLst[hotel_id]}'</Where>
<queryFormat>delete from %{table} where %{where}</queryFormat></DbDetails>
<submit namelist="DbDetails"/><submit/></op>
</operator>
<onclick><assign name="session.hotel_id" expr="%{ctu_hotels_vLst[hotel_id]}"/></onclick>
<OnChanged>
<assign name="pgcur_ctu_hotels" expr="js(%{ctu_hotels_vLst[currentpage]}+1)"/>
<assign name="pgscb_ctu_hotels" function="SetSel" expr="js(%{ctu_hotels_vLst[currentpage]}+1)"/>
</OnChanged></ListCtrl>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
</Ctrls>
<OnActivate>
	<if cond="%{purview}!=127">
		
		<SetVisible name="search_m" Visible="0"/>
		<SetVisible name="search_n" Visible="0"/>
		<SetVisible name="update" Visible="0"/>
		<SetVisible name="delcontact" Visible="0"/>
		<SetVisible name="resetall" Visible="0"/>
		<assign name="hotelonlys" expr="(manager_id = '%{user_code}' or hotel_id='%{hotel_id}')"/></if>
	<if cond="%{user_id_cur}!=%{user_code}"><assign name="user_id_cur" expr="%{user_code}"/>
		<DbDetails/><submit next="ctu_hotels_vLst" namelist="DbDetails"/></if>
</OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_Vm.xml" Text="ctu_pano_v" Name="ctu_pano_v">
<WndTaps>
<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_Vem.xml" Text="ctu_pano" Name="ctu_pano" popup="1" Ver="2">
<var name="refreshAfterEdit" expr="0"/>
<var name="dataRequired" expr=""/>
<var name="dataRequireless" expr=""/>
<Language xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\lan\ctu_pano.xml" name="ctu_pano">
<Lang name="ctu_pano" value="ctu_pano"/>
<Lang name="TabEditctu_pano" value="ctu_pano Edit"/>
<Lang name="TabViewctu_pano" value="ctu_pano View"/>
<Lang name="shortid" value=""/>
<Lang name="ttp_shortid" value=""/>
<Lang name="img" value=""/>
<Lang name="ttp_img" value=""/>
<Lang name="pano" value=""/>
<Lang name="ttp_pano" value=""/>
<Lang name="info" value=""/>
<Lang name="ttp_info" value=""/>
<Lang name="lats" value=""/>
<Lang name="ttp_lats" value=""/>
<Lang name="latn" value=""/>
<Lang name="ttp_latn" value=""/>
<Lang name="reftbl" value=""/>
<Lang name="ttp_reftbl" value=""/>
<Lang name="refkey" value=""/>
<Lang name="ttp_refkey" value=""/>
<Lang name="refid" value=""/>
<Lang name="ttp_refid" value=""/>
<Lang name="pano_id" value=""/>
<Lang name="ttp_pano_id" value=""/>
<Lang name="ttp_operationctu_pano" value="操作"/>
<Lang name="ttp_createctu_pano" value="新增"/>
<Lang name="ttp_modifyctu_pano" value="修改"/>
<Lang name="ttp_resetctu_pano" value="清除数据"/>
<Lang name="ttp_deletectu_pano" value="删除"/>
<Lang name="ttp_refreshctu_pano" value="刷新"/>
<Lang name="operation" value="操作"/>
<Lang name="create" value="新增"/>
<Lang name="modify" value="修改"/>
<Lang name="reset" value="复位"/>
<Lang name="delete" value="删除"/>
<Lang name="refresh" value="刷新"/>
<Lang name="firstpage" value="首页"/>
<Lang name="prepage" value="上页"/>
<Lang name="nextpage" value="下页"/>
</Language>
<Ctrls>
<GroupBox Text="ctu_pano" Name="GBctu_pano" id="ctu_pano" Size="100,100"><Ctrls>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_GBDEDIT.xml" Name="GBDEDITctu_pano"><Ctrls>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_path"><Ctrls>
<Label Align="Right" Text="path" onload="init" Name="lb_path" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_path" onload="init" Name="path" Size="170,100">
	<DbDetails>
<Index/>
<DbTable/>
<Data/>
<Where/>
<queryFormat>select * from . </queryFormat></DbDetails><DbDetails fcsm="1"><DbDatabase>D:\AppServ\www\cha\vr\pano</DbDatabase> <datatype>dir</datatype> </DbDetails><OnSelEndOk><submit next="img"/><submit next="pano"/></OnSelEndOk></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_img"><Ctrls>
<Label Align="Right" Text="img" onload="init" Name="lb_img" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_img" onload="init" Name="img" Size="170,100">
	<DbDetails>
<Index/>
<DbTable/>
<Data/>
<Where/>
<queryFormat>select * from . where filetype=png</queryFormat></DbDetails><DbDetails fcsm="1"><DbDatabase>D:\AppServ\www\cha\vr\pano\%{path}</DbDatabase> <datatype>dir</datatype> </DbDetails></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_pano"><Ctrls>
<Label Align="Right" Text="pano" onload="init" Name="lb_pano" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_pano" onload="init" Name="pano" Size="170,100">
	<DbDetails>
<Index/>
<DbTable/>
<Data/>
<Where/>
<queryFormat>select * from . where filetype=jpg</queryFormat></DbDetails><DbDetails fcsm="1"><DbDatabase>D:\AppServ\www\cha\vr\pano\%{path}</DbDatabase> <datatype>dir</datatype> </DbDetails></ComboBox>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_info"><Ctrls>
<Label Align="Right" Text="info" Name="lb_info" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_info" Name="info" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_lats"><Ctrls>
<Label Align="Right" Text="lats" Name="lb_lats" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_lats" Name="lats" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_latn"><Ctrls>
<Label Align="Right" Text="latn" Name="lb_latn" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_latn" Name="latn" Size="170,20"/>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_reftbl"><Ctrls>
<Label Align="Right" Text="reftbl" Name="lb_reftbl" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_reftbl" Items="hotels|rooms|roomtype" Name="reftbl" Size="170,100"><OnSelEndOk><submit next="refkey"/></OnSelEndOk></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_refkey"><Ctrls>
<Label Align="Right" Text="refkey" Name="lb_refkey" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_refkey" Name="refkey" Size="170,100">
	<DbDetails>
<Index/>
<DbTable/>
<Data/>
<Where/>
<queryFormat>show full fields from creator.ctu_%{reftbl}</queryFormat></DbDetails></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_refid"><Ctrls>
<Label Align="Right" Text="refid" Name="lb_refid" Size="60,20"/>
<TextBox Weight="170" Text="" ToolTip="ttp_refid" Name="refid" Size="170,20"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_pano_id" Visible="false"><Ctrls>
<Label Align="Right" Text="pano_id" overlap="pre" Name="lb_pano_id" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_pano_id" overlap="pre" Name="pano_id" readonly="true" Size="170,20" Visible="false"><OnEnChange><if cond="'%{pano_id}'"><SetVisible name="insertctu_pano" Visible="0"/><SetVisible name="modifyctu_pano" Visible="1"/><else/><SetVisible name="insertctu_pano" Visible="1"/><SetVisible name="modifyctu_pano" Visible="0"/></if></OnEnChange></TextBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_shortid" Visible="false"><Ctrls>
<Label Align="Right" Text="shortid" overlap="pre" Name="lb_shortid" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_shortid" overlap="pre" Name="shortid" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_visited" Visible="false"><Ctrls>
<Label Align="Right" Text="visited" overlap="pre" Name="lb_visited" readonly="true" Size="60,20" Visible="false"/>
<TextBox Weight="170" Text="" ToolTip="ttp_visited" overlap="pre" Name="visited" readonly="true" Size="170,20" Visible="false"/>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" overlap="pre" Name="GB_lastvisitdt" Visible="false"><Ctrls>
<Label Align="Right" Text="lastvisitdt" overlap="pre" Name="lb_lastvisitdt" readonly="true" Size="60,20" Visible="false"/>
<DateTime Weight="170" Text="" ToolTip="ttp_lastvisitdt" overlap="pre" Name="lastvisitdt" readonly="true" Size="170,20" Visible="false" Format="yyyy-MM-dd HH:mm:ss"/>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_GBOPE.xml" cols="xs12 sm6 md4" Name="GBOPEctu_pano" Size="100,100"><Ctrls>
<Button sqlpkinsert="pano_id" Text="create" ToolTip="ttp_createctu_pano" Name="insertctu_pano" Size="50,20">
<OnClick>
<DbDetails mode="insert" fcsm="1">
<DbTable>creator.ctu_pano</DbTable>
<Required>%{dataRequired}</Required>
<Requireless>%{dataRequireless}</Requireless>
<Data>path,img,pano,info,lats,latn,reftbl,refkey,refid</Data>
<DataEx/>
<queryFormat>insert into %{table} %{data}</queryFormat></DbDetails>
<submit namelist="DbDetails"/><if cond="!%{insertctu_pano[broke]}"><if cond="%{refreshAfterEdit}==1"><submit next="ctu_panoLst" delay="1000"/><elseif cond="%{refreshAfterEdit}==2"/><if cond="1"><if cond="'%{frmwndctrl}'"><submit next="%{frmwndctrl}" delay="1000"/><else/><submit next="$parent.ctu_pano_vLst" delay="1000"/></if></if></if></if>
	</OnClick>
	</Button><TAB/>
<Button Text="modify" ToolTip="ttp_modifyctu_pano" Name="modifyctu_pano" Size="50,20">
<OnClick>
<DbDetails mode="update" fcsm="1">
<DbTable>creator.ctu_pano</DbTable>
<Required>%{dataRequired}</Required>
<Requireless>%{dataRequireless}</Requireless>
<Data>path,img,pano,info,lats,latn,reftbl,refkey,refid</Data>
<DataEx/>
<Where>pano_id='%{pano_id}'</Where>
<queryFormat>update %{table} set %{data} where %{where}</queryFormat></DbDetails>
<submit namelist="DbDetails"/><if cond="!%{modifyctu_pano[broke]}"><if cond="%{refreshAfterEdit}==1"><submit next="ctu_panoLst" delay="1000"/><elseif cond="%{refreshAfterEdit}==2"/><if cond="'%{frmwndctrl}'"><submit next="%{frmwndctrl}" delay="1000"/><else/><submit next="$parent.ctu_pano_vLst" delay="1000"/></if></if></if>
	</OnClick>
</Button><TAB/>
<Button Text="reset" ToolTip="ttp_resetctu_pano" Name="resetctu_pano" Size="50,20">
<OnClick>
<submit next="GBDEDITctu_pano" function="reset"/>
	</OnClick>
</Button><TAB/>
<Button Text="Search" ToolTip="ttp_gsearchctu_pano" Name="gsearchctu_pano" Size="50,20" visible="false">
<OnClick>
<search next="ctu_panoLst" listed="0" prefixwhere="0" prefixand="0" inputed="1"/><submit next="GBDEDITctu_pano" namelist="search" function="search"/>
	</OnClick>
</Button><TAB/>
</Ctrls></GroupBox>
<Button Text="上传图片" Name="SendFile" OnClick="SendFile:,filter=*.jpg|*.jpg|*.png|*.png|,dir=D:\AppServ\www\cha\vr\pano\%{path},localdir=" Size="100,20"/>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_Vh.xml" cols="xs12 sm12 md12 lg12" Name="GBDVctu_pano" visible="0"><Ctrls>
<ListCtrl loadedclick="1" ToolTip="ttp_ctu_pano" Name="ctu_panoLst" Size="70,20" visible="0">
	<DbDetails fcsm="1">
<Index>pano_id</Index>
<DbTable>creator.ctu_pano</DbTable>
<Data>path,img,pano,info,lats,latn,reftbl,refkey,refid,pano_id,shortid,visited,lastvisitdt</Data>
<Order>pano_id</Order></DbDetails>
<OnClick>
<if cond="'%{pano_id}'"><SetVisible name="insertctu_pano" Visible="0"/><SetVisible name="modifyctu_pano" Visible="1"/></if>
</OnClick>
</ListCtrl>
</Ctrls></GroupBox></Ctrls></GroupBox></Ctrls>
	<OnChanged/>
	<OnActivate><SetVisible name="insertctu_pano" Visible="1"/><SetVisible name="modifyctu_pano" Visible="0"/></OnActivate>
</WndTap>
</WndTaps>
<var name="searchtmpl"><path format="(c.path like '%%{opvalue}%')"/><img format="(c.img like '%%{opvalue}%')"/><pano format="(c.pano like '%%{opvalue}%')"/><info format="(c.info like '%%{opvalue}%')"/><lats format="(c.lats like '%%{opvalue}%')"/><latn format="(c.latn like '%%{opvalue}%')"/><reftbl format="(c.reftbl like '%%{opvalue}%')"/><refkey format="(c.refkey like '%%{opvalue}%')"/><refid format="(c.refid like '%%{opvalue}%')"/><pano_id format="(c.pano_id like '%%{opvalue}%')"/><shortid format="(c.shortid like '%%{opvalue}%')"/><visited format="(c.visited like '%%{opvalue}%')"/><lastvisitdt format="(c.lastvisitdt between '%{lastvisitdt[datetime]}' and '%{lastvisitdt[datetime2]}')"/></var>
<Language xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\lan\ctu_pano.xml" name="ctu_pano">
<Lang name="ctu_pano" value="ctu_pano"/>
<Lang name="TabEditctu_pano" value="ctu_pano Edit"/>
<Lang name="TabViewctu_pano" value="ctu_pano View"/>
<Lang name="shortid" value=""/>
<Lang name="ttp_shortid" value=""/>
<Lang name="img" value=""/>
<Lang name="ttp_img" value=""/>
<Lang name="pano" value=""/>
<Lang name="ttp_pano" value=""/>
<Lang name="info" value=""/>
<Lang name="ttp_info" value=""/>
<Lang name="lats" value=""/>
<Lang name="ttp_lats" value=""/>
<Lang name="latn" value=""/>
<Lang name="ttp_latn" value=""/>
<Lang name="reftbl" value=""/>
<Lang name="ttp_reftbl" value=""/>
<Lang name="refkey" value=""/>
<Lang name="ttp_refkey" value=""/>
<Lang name="refid" value=""/>
<Lang name="ttp_refid" value=""/>
<Lang name="pano_id" value=""/>
<Lang name="ttp_pano_id" value=""/>
<Lang name="ttp_operationctu_pano" value="操作"/>
<Lang name="ttp_createctu_pano" value="新增"/>
<Lang name="ttp_modifyctu_pano" value="修改"/>
<Lang name="ttp_resetctu_pano" value="清除数据"/>
<Lang name="ttp_deletectu_pano" value="删除"/>
<Lang name="ttp_refreshctu_pano" value="刷新"/>
<Lang name="operation" value="操作"/>
<Lang name="create" value="新增"/>
<Lang name="modify" value="修改"/>
<Lang name="reset" value="复位"/>
<Lang name="delete" value="删除"/>
<Lang name="refresh" value="刷新"/>
<Lang name="firstpage" value="首页"/>
<Lang name="prepage" value="上页"/>
<Lang name="nextpage" value="下页"/>
</Language>
<Ctrls><GroupBox Text="ctu_pano" Name="GBctu_pano" id="ctu_pano" Size="100,100"><Ctrls>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_Vs.xml" text="Search" toggle="1" Name="GBDEDITctu_pano"><Ctrls>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_path"><Ctrls>
<Label Align="Right" Text="path" onload="init" Name="lb_path" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_path" onload="init" Name="path" Size="170,100">
	<DbDetails>
<Index/>
<DbTable/>
<Data/>
<Where/>
<queryFormat>select * from . </queryFormat></DbDetails><DbDetails fcsm="1"><DbDatabase>D:\AppServ\www\cha\vr\pano</DbDatabase> <datatype>dir</datatype> </DbDetails><OnSelEndOk><submit next="img"/><submit next="pano"/></OnSelEndOk></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_img"><Ctrls>
<Label Align="Right" Text="img" onload="init" Name="lb_img" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_img" onload="init" Name="img" Size="170,100">
	<DbDetails>
<Index/>
<DbTable/>
<Data/>
<Where/>
<queryFormat>select * from . where filetype=png</queryFormat></DbDetails><DbDetails fcsm="1"><DbDatabase>D:\AppServ\www\cha\vr\pano\%{path}</DbDatabase> <datatype>dir</datatype> </DbDetails></ComboBox>
</Ctrls></GroupBox>
<GroupBox cols="xs12 sm6 md4" Multiline="0" Name="GB_pano"><Ctrls>
<Label Align="Right" Text="pano" onload="init" Name="lb_pano" Size="60,20"/>
<ComboBox Weight="170" Text="" ToolTip="ttp_pano" onload="init" Name="pano" Size="170,100">
	<DbDetails>
<Index/>
<DbTable/>
<Data/>
<Where/>
<queryFormat>select * from . where filetype=jpg</queryFormat></DbDetails><DbDetails fcsm="1"><DbDatabase>D:\AppServ\www\cha\vr\pano\%{path}</DbDatabase> <datatype>dir</datatype> </DbDetails></ComboBox>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox cols="xs12 sm6 md4" Name="GBOPVctu_pano" Size="100,20"><Ctrls>
<Button Text="addone" ToolTip="ttp_addone" Name="addone" Size="50,20">	<OnClick><submit next="$this.ctu_pano.GBDEDITctu_pano" function="reset"/><assign name="$this.ctu_pano.frmwndctrl" expr="%{$this.ctu_pano_vLst}"/></OnClick>	</Button><TAB/>	
<Button Text="reset" ToolTip="ttp_resetctu_pano" Name="resetctu_pano" Size="50,20">	<OnClick>	<submit next="GBDEDITctu_pano" function="reset"/>	</OnClick>	</Button><TAB/>	
<Button Text="Search" ToolTip="ttp_gsearchctu_pano" Name="gsearchctu_pano" Size="50,20">	<OnClick>	
<search next="ctu_pano_vLst" listed="0" prefixwhere="0" prefixand="0" inputed="1">%{searchtmpl}</search><submit next="GBDEDITctu_pano" namelist="search" function="search"/>	
<search next="records_ctu_pano" listed="0" prefixwhere="1" prefixand="0" inputed="1">%{searchtmpl}</search><submit next="GBDEDITctu_pano" namelist="search" function="search"/>	
</OnClick></Button><TAB/></Ctrls></GroupBox>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_Vpg.xml" cols="xs12 sm6 md4" Multiline="0" Name="GBPGctu_pano"><Ctrls>
<Label Align="Right" Text="Records" Name="lb_Records" Size="60,20"/>
<TextBox Weight="30" ToolTip="ttp_records" OnLoad="init" Name="records_ctu_pano" readonly="1" Size="40,20">
	<DbDetails fcsm="1">
<Index>pano_id</Index>
<DbTable>creator.ctu_pano c</DbTable>
<Data>count(*) records</Data>
<Order>pano_id</Order><Queryformat>select %{data} from (select c.pano_id from %{dbtable} %{where} GROUP BY c.pano_id  ORDER BY c.pano_id) t</Queryformat></DbDetails>
<OnEnchange>
<assign name="pgs_ctu_pano" expr="js(Math.ceil(%{records_ctu_pano}/%{ctu_pano_vLst[countsperpage]}))"/>
<assign name="pgscb_ctu_pano" function="setitems" expr="js('1~'+Math.ceil(%{records_ctu_pano}/%{ctu_pano_vLst[countsperpage]}))"/>
</OnEnchange>
</TextBox>

<TextBox Weight="30" ToolTip="ttp_pgs" Name="pgs_ctu_pano" readonly="1" Size="30,20"/>
<TextBox Weight="30" ToolTip="ttp_pgcur" Name="pgcur_ctu_pano" Size="30,20"/>
<Button Text="go2Page" Name="go2pagectu_pano_vLst" Size="50,20"><OnClick><submit next="ctu_pano_vLst" function="GetPage(%{pgcur_ctu_pano}-1)"/></OnClick></Button>
</Ctrls></GroupBox>
<GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_Vpgop.xml" cols="xs12 sm6 md4" Name="GBOPVctu_pano"><Ctrls>
<TAB/><Button Text="initial" ToolTip="ttp_initial" Name="initialctu_pano" Size="50,20">
<OnClick><submit next="ctu_pano_vLst" function="initial"/><submit next="records_ctu_pano" function="initial"/></OnClick></Button>
<TAB/><Button Text="firstpage" Name="FPctu_pano_vLst" Size="50,20">
<OnClick><submit next="ctu_pano_vLst" function="GetPage(first)"/><submit next="records_ctu_pano"/></OnClick></Button>
<Button Text="prepage" Name="PREctu_pano_vLst" Size="50,20">
<OnClick><submit next="ctu_pano_vLst" function="GetPage(Pre)"/></OnClick></Button>
<Button Text="nextpage" Name="NPctu_pano_vLst" Size="50,20">
<OnClick><submit next="ctu_pano_vLst" function="GetPage(Next)"/></OnClick></Button>
</Ctrls></GroupBox>
<BR AutoHeight="1"/><GroupBox xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\ctu_pano_Vvm.xml" cols="xs12 sm12 md12 lg12" Name="GBDVctu_pano"><Ctrls>
<ListCtrl Heading="path,120;img,120;pano,120;info,640;lats,20;latn,20;reftbl,120;refkey,120;refid,55;pano_id,55;shortid,50;visited,55;lastvisitdt,150;" loadedclick="0" ToolTip="ttp_ctu_pano" OnLoad="init" Name="ctu_pano_vLst" Size="700,450" pagesize="50">
	<DbDetails>
<DbTable>creator.ctu_pano c</DbTable>
<Index>pano_id</Index>
<Data>c.path,c.img,c.pano,c.info,c.lats,c.latn,c.reftbl,c.refkey,c.refid,c.pano_id,c.shortid,c.visited,c.lastvisitdt</Data>
<Order>pano_id</Order>
<queryFormat>select %{data} from %{dbtable} %{where} order by %{Order} desc limit %{StartRow},%{PgSize}</queryFormat></DbDetails>
<operator firstpage="1" nextpage="1" refresh="1" prepage="1">
<op text="modify"><DbDetails><Where>pano_id='%{ctu_pano_vLst[pano_id]}'</Where></DbDetails><submit next="$this.ctu_pano.ctu_panoLst" namelist="DbDetails"/><assign name="$this.ctu_pano.frmwndctrl" expr="%{this}"/></op>
<op text="delete" needconfirm="1"><DbDetails>
<DbTable>creator.ctu_pano</DbTable>
<Where>pano_id='%{ctu_pano_vLst[pano_id]}'</Where>
<queryFormat>delete from %{table} where %{where}</queryFormat></DbDetails>
<submit namelist="DbDetails"/><submit/></op>
</operator>
<OnChanged>
<assign name="pgcur_ctu_pano" expr="js(%{ctu_pano_vLst[currentpage]}+1)"/>
<assign name="pgscb_ctu_pano" function="SetSel" expr="js(%{ctu_pano_vLst[currentpage]}+1)"/>
</OnChanged></ListCtrl>
</Ctrls></GroupBox>
</Ctrls></GroupBox>
</Ctrls></WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\hostels.xml" Text="酒店管理" Name="hostels">
	<var name="hotelonlys" expr=""/>
	<var name="user_id_catch" expr=""/>
	<Ctrls>
		<GroupBox Text="基本资料" Name="GroupBox1" Size="750,220"><Ctrls>
		<Label Text="店名" Name="lb_name" Size="30,20"/>
		<TextBox Text="" Name="TB_name" ReadOnly="false" Size="100,20"/>
		<Button Text="搜" Name="search_n" Size="15,20">
			<OnClick><if cond="%{TB_name}"><DbDetails><where>where HotelName like '%%{TB_name}%'</where></DbDetails><submit next="innsLst" namelist="DbDetails" method="post"/></if></OnClick></Button>
		<TAB/>
		<Label Text="负责人" Name="lb_manager" Size="40,20"/>
		<TextBox Text="" Name="TB_manager" ReadOnly="false" Size="50,20"/>
		<TAB/>
		<Label Text="移动电话" Name="lb_moblie" Size="50,20"/>
		<TextBox Text="" Name="TB_mobile" ReadOnly="false" Size="80,20"/>
		<Button Text="搜" Name="search_m" Size="15,20">
			<OnClick><if cond="%{TB_mobile}"><DbDetails><where>where (mobile='%{TB_mobile}' or phone='%{TB_mobile}')</where></DbDetails><submit next="innsLst" namelist="DbDetails" method="post"/></if></OnClick></Button>
		<Button Text="呼叫" Name="dial0" OnClick="nis3ucs:%{TB_mobile}" Size="30,20"/>
		<TAB/>
		<Label Text="固定电话" Name="lb_phone" Size="50,20"/>
		<TextBox Text="" Name="TB_phone" ReadOnly="false" Size="80,20"/>
		<Button Text="呼叫" Name="dial" OnClick="nis3ucs:%{TB_phone}" Size="30,20"/>
		<TextBox Text="" ToolTip="门店相册" Name="TB_picinn" ReadOnly="false" Size="40,20"/>
		<TextBox Text="" ToolTip="周边摄影相册" Name="TB_album" ReadOnly="false" Size="40,20"/>
		<Label Location="30,30" Text="编号" Name="lb_code" Size="30,20" Visible="false" Enabled="true"/>
		<TextBox Text="" Name="TB_code" ReadOnly="false" Size="30,20" Visible="false" Enabled="true"> 
			<DbDetails>
			<DbTable/>
			<Data/>
			<Order/>
			<Where/>
			<queryFormat>select hotel_id from creator.ctu_hotels %{where} order by hotel_id desc limit 0,1</queryFormat> 
			</DbDetails>
			<OnEnChange><if cond="%{TB_code}"><DbDetails/><submit next="HistoryList" namelist="DbDetails" method="post"/>
			<assign name="CB_content" function="SetSel" expr="-1"/>
			<assign name="TB_remarkh" function="SetText" expr=" "/>
			<else/><submit next="HistoryList" method="post" function="resetcontent"/></if></OnEnChange>
			</TextBox>
		<BR/>
		<Label Text="地址" Name="lb_addr" Size="30,20"/>
		<ComboBox OnLoad="init" Name="provinces" Size="60,200" Type="3" SelectedIndex="-1">
			<DbDetails>
			<queryFormat>select province_name,province_code from creator.ctu_province</queryFormat> 
			</DbDetails>
			
			<OnSELENDOK><if cond="%{provinces[province_code]}">
				<DbDetails>
				<queryFormat>select city_name,city_code from creator.ctu_city where city_province_code=%{provinces[province_code]} and city_area_code=0</queryFormat> 
				</DbDetails>
				<submit next="areas" namelist="DbDetails" method="post"/>
				<else/><submit next="areas" function="resetcontent"/>
				</if></OnSELENDOK>
			</ComboBox>
		<ComboBox Name="areas" Size="60,200" Type="3" SelectedIndex="-1">
			<OnSELENDOK><if cond="%{areas[city_code]}">
				<DbDetails>
				<queryFormat>select city_name,city_code from creator.ctu_city where city_area_code=%{areas[city_code]}</queryFormat> 
				</DbDetails>
				<submit next="citys" namelist="DbDetails" method="post"/>
				<else/><submit next="citys" function="resetcontent"/>
				</if></OnSELENDOK>
			</ComboBox>
		<ComboBox Name="citys" Size="100,300" Type="3" SelectedIndex="-1">
			<OnSELENDOK>
				<if cond="%{citys}"><assign name="TB_addr" expr="%{provinces}%{citys}"/></if>
				</OnSELENDOK></ComboBox>
		<TextBox Text="" Name="TB_addr" ReadOnly="false" Size="260,20"/>
		<TAB/>
		<DateTime Name="OpenDT" Size="80,20" Format="yyyy-MM-dd"/>
		<ComboBox OnLoad="init" Name="chainBrand" Size="100,100" Type="3" SelectedIndex="1">
			<DbDetails>
			<queryFormat>select chain_name_cn,chain_id from creator.ctu_chainbrand</queryFormat> 
			</DbDetails></ComboBox>
		<BR/>

		<TextBox ToolTip="酒店/客栈概况" EscapeString="&lt;BR/&gt;" Name="TB_Content" Size="600,160"/>
		<TextBox ToolTip="交通说明" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_traffic" Size="600,160" visible="0"/>
		<TextBox ToolTip="老板简介" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_boss" Size="600,160" visible="0"/>
		<TextBox ToolTip="配套服务" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_Service" Size="600,160" visible="0"/>
		<TextBox ToolTip="房型价格" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_BedPrice" Size="600,160" visible="0"/>
		<TextBox ToolTip="客栈周边景点" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_Scenic" Size="600,160" visible="0"/>
		<TextBox ToolTip="客栈周边美食地图" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_delicacy" Size="600,160" visible="0"/>
		<TextBox ToolTip="客栈周边特产" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_Specialty" Size="600,160" visible="0"/>
		<TextBox ToolTip="当地旅游常用电话" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_pubphones" Size="600,160" visible="0"/>
		<TextBox ToolTip="客栈标签" overlap="pre" EscapeString="&lt;BR/&gt;" Name="TB_Tags" Size="600,160" visible="0"/>
		<TextBox ToolTip="备注" overlap="pre" EscapeString="&lt;br&gt;" Name="TB_remark" Size="600,160" visible="0"/>
		<TAB/><GroupBox Text="操作" Name="GroupBox1Child"><Ctrls>
		<ComboBox Items="暂停服务|服务中" Name="InService" Size="80,100" Type="3" SelectedIndex="1"/>
		<BR/><Button Text="新增" Name="insert" Size="30,20">
			<OnClick>
			<if cond="!%{TB_name}"><alert next="TB_name" expr="%{lb_name}不能为空"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_hotels (HotelName, phone, mobile, Traffic, Service, Address, Content, CityID,CityName, manager,manager_id, chain_name,chain_id,remark,opendate,uptime,picture,album,BedPrice,Scenic,delicacy, Specialty, pubphones, Tags,boss) values('%{TB_name}','%{TB_phone}','%{TB_mobile}','%{TB_traffic}','%{TB_Service}','%{TB_addr}','%{TB_Content}','%{citys[city_code]}','%{citys[city_name]}','%{TB_manager}',%{user_code},'%{chainBrand[chain_name_cn]}',%{chainBrand[chain_id]},'%{TB_remark}','%{OpenDT}',UNIX_TIMESTAMP(),'%{TB_picinn}','%{TB_album}','%{TB_BedPrice}','%{TB_Scenic}','%{TB_delicacy}','%{TB_Specialty}','%{TB_pubphones}','%{TB_Tags}','%{TB_boss}')</queryFormat></DbDetails><submit next="insert" namelist="DbDetails" method="post"/>
			<DbDetails><Where>where HotelName='%{TB_name}'</Where></DbDetails><submit next="TB_code" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		<TAB/>
		<Button Text="修改" Name="update" Size="30,20">
			<OnClick><assign name="break" expr="0"/><assign name="cityparam" expr=""/>
			<if cond="%{citys[city_code]}"><if cond="%{innsLst[CityID]}!=%{citys[city_code]}"><confirm expr="要修改所在城市么?"/><if cond="%{update[confirmed]}"><assign name="cityparam" expr=",CityID=%{citys[city_code]},CityName='%{citys[city_name]}'"/></if></if></if>
			<if cond="!%{break}"><DbDetails><queryFormat>Update creator.ctu_hotels set HotelName='%{TB_name}',phone='%{TB_phone}',mobile='%{TB_mobile}',Traffic='%{TB_traffic}',Service='%{TB_Service}',address='%{TB_addr}',Content='%{TB_Content}'%{cityparam},manager='%{TB_manager}',chain_name='%{chainBrand[chain_name_cn]}',chain_id=%{chainBrand[chain_id]}, opendate='%{OpenDT}',uptime=UNIX_TIMESTAMP(),actived=%{InService[SelectedIndex]},picture='%{TB_picinn}',album='%{TB_album}',BedPrice='%{TB_BedPrice}',Scenic='%{TB_Scenic}',delicacy='%{TB_delicacy}',Specialty='%{TB_Specialty}',pubphones='%{TB_pubphones}',Tags='%{TB_Tags}',boss='%{TB_boss}', qq='%{TB_qq}' where hotel_id=%{TB_code}</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		<BR/>
		<Button Text="查找" Name="search" Size="30,20">
			<OnClick><DbDetails/><submit next="innsLst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<TAB/>
		<Button Text="删除" Name="delcontact" OnClick="sql:Update creator.ctu_hotels set activited=0 where hotel_id=%{TB_code}" Size="30,20"/>
		<BR/>
		<Button Text="清空数据" Name="resetall" OnClick="SetText(TB_code,);SetText(TB_name,);SetSel(CB_sex,0);SetText(TB_mobile,);SetText(TB_phone,);SetText(TB_email,);SetText(TB_addr,);SetText(TB_Post,);SetText(TB_remark,);SetText(TB_fax, );SetText(TB_website,);SetText(TB_title,);SetText(TB_company,);SetText(TB_TEL,);SetText(TB_depart,)" Size="50,20">
			</Button></Ctrls></GroupBox>
		<BR autoHeight="1"/>
		<Button Text="概况" Name="btn_content" Size="50,20" enabled="0">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_content" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="交通" Name="btn_traffic" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_traffic" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="掌柜" Name="btn_boss" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_boss" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="其它服务" Name="btn_Service" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_Service" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="房型价格" Name="btn_BedPrice" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_BedPrice" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="周边景点" Name="btn_Scenic" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_Scenic" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="周边美食" Name="btn_delicacy" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_delicacy" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="特产" Name="btn_Specialty" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_Specialty" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="服务电话" Name="btn_pubphones" Size="50,20" ToolTop="公共服务电话">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_pubphones" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="标签" Name="btn_Tags" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_Tags" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="备注" Name="btn_remark" Size="50,20">
			<OnClick><submit next="enabledall" function="click"/>
				<SetEnabled Name="btn_remark" enabled="0"/>
				<submit next="switchshow" function="click"/>
				</OnClick></Button>
		<Button Text="使能选择按钮" Name="enabledall" Size="50,20" visible="0">
			<OnClick>
			<SetEnabled Name="btn_content" enabled="1"/>
			<SetEnabled Name="btn_traffic" enabled="1"/>
			<SetEnabled Name="btn_boss" enabled="1"/>
			<SetEnabled Name="btn_Service" enabled="1"/>
			<SetEnabled Name="btn_BedPrice" enabled="1"/>
			<SetEnabled Name="btn_Scenic" enabled="1"/>
			<SetEnabled Name="btn_delicacy" enabled="1"/>
			<SetEnabled Name="btn_Specialty" enabled="1"/>
			<SetEnabled Name="btn_pubphones" enabled="1"/>
			<SetEnabled Name="btn_Tags" enabled="1"/>
			<SetEnabled Name="btn_remark" enabled="1"/>
			</OnClick></Button>
		<Button Text="使能选择按钮" Name="switchshow" Size="50,20" visible="0">
			<OnClick>
			<SetVisible Name="TB_content" Visible="1-%{btn_content[enabled]}"/>
			<SetVisible Name="TB_traffic" Visible="1-%{btn_traffic[enabled]}"/>
			<SetVisible Name="TB_boss" Visible="1-%{btn_boss[enabled]}"/>
			<SetVisible Name="TB_Service" Visible="1-%{btn_Service[enabled]}"/>
			<SetVisible Name="TB_BedPrice" Visible="1-%{btn_BedPrice[enabled]}"/>
			<SetVisible Name="TB_Scenic" Visible="1-%{btn_Scenic[enabled]}"/>
			<SetVisible Name="TB_delicacy" Visible="1-%{btn_delicacy[enabled]}"/>
			<SetVisible Name="TB_Specialty" Visible="1-%{btn_Specialty[enabled]}"/>
			<SetVisible Name="TB_pubphones" Visible="1-%{btn_pubphones[enabled]}"/>
			<SetVisible Name="TB_Tags" Visible="1-%{btn_Tags[enabled]}"/>
			<SetVisible Name="TB_remark" Visible="1-%{btn_remark[enabled]}"/>
			</OnClick></Button>
		
			</Ctrls></GroupBox>
		<BR autoHeight="1"/>
		<GroupBox Text="门店列表" Name="GroupBox2" Size="50,200"><Ctrls>
			<ListCtrl Heading="店名,100;负责人,60;电话,80;手机,80;品牌,80;城市,60;地址,100;" Name="innsLst" OnClick="SetText(TB_code,%{hotel_id});SetText(TB_name,%{HotelName});SetText(TB_phone,%{phone});SetText(TB_mobile,%{mobile});SetText(TB_traffic,%{Traffic});SetText(TB_Service,%{Service});SetText(TB_addr,%{Address});SetText(TB_Content,%{Content});SetText(TB_manager,%{manager});SetSel(chainBrand,%{chain_name});SetText(TB_remark,%{remark});SetSel(InService,%{actived});SetText(OpenDT,%{opendate});SetText(TB_picinn,%{picture});SetText(TB_album,%{album});SetText(TB_BedPrice,%{BedPrice});SetText(TB_Scenic,%{Scenic});SetText(TB_delicacy,%{delicacy});SetText(TB_Specialty, %{Specialty});SetText(TB_pubphones,%{pubphones});SetText(TB_Tags,%{Tags});SetText(TB_boss,%{boss});SetText(TB_qq,%{qq});SetText(TB_url,%{url})" Size="250,150" PageSize="50">
				<DbDetails>
					<DbTable>creator.ctu_hotels</DbTable>
					<Index>hotel_id</Index>
					<Data>HotelName, manager,phone, mobile, chain_name, CityName,Address,CityID,opendate,actived,FROM_UNIXTIME(uptime,'%Y-%m-%d') as uptime,Traffic, Content,Service,chain_id,concat(remark,contactinfo) as remark,hotel_id,picture,album,BedPrice,Scenic,delicacy, Specialty, pubphones, Tags, boss,qq,concat('烦请核实您的客栈资料, http://centyou.com/',url) as url</Data>
					<Order>hotel_id</Order>
					<Where>where actived</Where>
					<queryFormat>select %{data} from %{dbtable} %{hotelonlys} order by %{order} limit %{StartRow},%{PgSize}</queryFormat> 
				</DbDetails>
			</ListCtrl>
			<BR AutoHeight="1"/>
			<Button Text="首页" Name="FirstPage" OnClick="(innsLst)GetPage(First)" Size="80,20"/>
			<Button Text="上一页" Name="PrePage" OnClick="(innsLst)GetPage(Pre)" Size="80,20"/>
			<Button Text="下一页" Name="NextPage" OnClick="(innsLst)GetPage(Next)" Size="80,20"/>
			</Ctrls></GroupBox>

		<GroupBox Text="店评历史记录" Name="GroupBox3" Size="480,200"><Ctrls>
			<ListCtrl Heading="客人姓名,100;房间号,100;点评,100" Name="HistoryList" Size="470,180" PageSize="10">
				<DbDetails>
					<DbTable>creator.ctu_inns_reviewer_reviewer as v inner join creator.ctu_reservation as s on v.reviewer_reviewer_resvid=s.reservation_id</DbTable>
					<Index/>
					<Data>s.custName,s.roomNo,v.reviewer_reviewer_review,v.reviewer_reviewer_id</Data>
					<Order>v.reviewer_reviewer_id desc</Order>
					<Where>where v.reviewer_reviewer_itemid=%{TB_code}</Where>
					<queryFormat>select %{data} from %{dbtable} %{where} order by %{order} </queryFormat> 
				</DbDetails>
			</ListCtrl></Ctrls></GroupBox>

		</Ctrls>      
	<OnActivate>
		<if cond="%{purview}!=127">
			
			<SetVisible name="search_m" Visible="0"/>
			<SetVisible name="search_n" Visible="0"/>
			<SetVisible name="update" Visible="0"/>
			<SetVisible name="delcontact" Visible="0"/>
			<SetVisible name="resetall" Visible="0"/>
			<assign name="hotelonlys" expr="where (manager_id = '%{user_code}' or hotel_id='%{hotel_id}')"/></if>
		<if cond="%{user_id_catch}!=%{user_code}"><assign name="user_id_catch" expr="%{user_code}"/>
		<DbDetails/><submit next="innsLst" namelist="DbDetails"/></if>
		</OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\roomtypes.xml" Text="客房类别" Name="roomtype">
	<var name="hotelid" expr="0"/>
	<var name="ChangeId" expr="0"/>
	<Ctrls>
		<GroupBox Text="客房类别" Name="GroupBox1" Visible="true" Enabled="true"><Ctrls>
		<Label Text="房间类型" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_name_rmtp" ReadOnly="false" Size="100,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="总数" Name="lb_num" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_num_rmtp" ReadOnly="false" Size="50,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="房间图片" Name="lb_url" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_url_rmtp" ReadOnly="false" Size="150,20" Visible="true" Enabled="true"/>
		<TAB/>
		<ComboBox Items="可编辑|审核中|发布中" Name="InService" Size="80,100" Visible="true" Enabled="true" Type="3" SelectedIndex="1"/>
		<TextBox Text="" Name="TB_code_rmtp" ReadOnly="false" Size="30,20" Visible="false" Enabled="false">
			<DbDetails>
				<DbTable/>
				<Index/>
				<Data/>
				<Order/>
				<Where>hotel_id=%{hotelid}</Where>
				<queryFormat>select roomtypeid from creator.ctu_roomtype %{where} order by roomtypeid desc limit 0,1</queryFormat> 
				</DbDetails>
			<OnEnChange><if cond="%{TB_code_rmtp}"><DbDetails/><submit next="rmprllst" namelist="DbDetails" method="post"/>
			<else/><submit next="rmprllst" method="post" function="resetcontent"/></if></OnEnChange>
			</TextBox>
		<TAB/>
		<BR/>
		<Label Text="房型概况" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_detail_rmtp" ReadOnly="false" Size="650,20" Visible="true" Enabled="true"/>
		<TAB/>
		<BR/>
		<ListCtrl sumcols="4" Heading="房型,100;描述,200;房型图片URL,300;数量,30;" Name="rmtplst" autosizecol="1" Sum="0,1" Size="600,100" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_roomtype</DbTable>
				<Data>roomtype,description,roomurl,num,actived,roomtypeid</Data>
				<Order>order by roomtypeid</Order>
				<Where>where hotel_id=%{hotelid}</Where>
				<queryFormat>select %{data} from %{dbtable} %{where} %{order}</queryFormat> 
			</DbDetails>
			<OnClick>
				<assign name="TB_code_rmtp" function="SetText" expr="%{rmtplst[roomtypeid]}"/>
				<assign name="TB_name_rmtp" function="SetText" expr="%{rmtplst[roomtype]}"/>
				<assign name="TB_detail_rmtp" function="SetText" expr="%{rmtplst[description]}"/>
				<assign name="TB_url_rmtp" function="SetText" expr="%{rmtplst[roomurl]}"/>
				<assign name="TB_num_rmtp" function="SetText" expr="%{rmtplst[num]}"/>
				<assign name="InService" function="SetSel" expr="%{rmtplst[actived]}"/>
				<if cond="%{purview}!=127">
				<if cond="%{rmtplst[actived]}"><SetVisible name="update" Visible="0"/><else/><SetVisible name="update" Visible="1"/></if>
				</if></OnClick>
		</ListCtrl>
		<TAB/><GroupBox Text="操作" Name="GroupBox1Child" Visible="true" Enabled="true"><Ctrls>
		<Button Text="新增" ToolTip="增加一个房型" Name="insert" Size="80,20" Visible="true" Enabled="true">
			<OnClick>
			<if cond="!%{TB_name_rmtp}"><alert next="TB_name_rmtp" expr="%{lb_name}不能为空"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_roomtype (hotel_id,roomtype,description,roomurl,num) values(%{hostels.TB_code},'%{TB_name_rmtp}','%{TB_detail_rmtp}','%{TB_url_rmtp}',%{TB_num_rmtp})</queryFormat></DbDetails><submit next="insert" namelist="DbDetails" method="post"/>
			<DbDetails><Where>where hotel_id=%{hotelid}</Where></DbDetails><submit next="TB_code_rmtp" namelist="DbDetails" method="post"/>
			<submit next="search" method="post" function="click"/>
			<assign name="ChangeId" expr="%{ChangeId}+1"/>
			</if></OnClick></Button>
		<TAB/>
		<Button Text="刷新" Name="search" Size="80,20" Visible="true" Enabled="true">
			<OnClick><DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
		<Button Text="修改" ToolTip="修改所选房型的参数，如名称、数量、房间概况或改变状态（可编辑、审核、发布）" Name="update" Size="80,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><queryFormat>Update creator.ctu_roomtype set roomtype='%{TB_name_rmtp}',description='%{TB_detail_rmtp}',roomurl='%{TB_url_rmtp}',num=%{TB_num_rmtp},actived=%{InService[SelectedIndex]} where roomtypeid=%{TB_code_rmtp}</queryFormat></DbDetails><submit next="update" namelist="DbDetails" method="post"/>
				<assign name="ChangeId" expr="%{ChangeId}+1"/><submit next="search" method="post" function="click"/></OnClick></Button>
			</Ctrls></GroupBox>
		</Ctrls></GroupBox>

		<BR autoheight="1"/>
		<GroupBox Text="客房价格系列" Name="GroupBox2" Visible="true" Enabled="true"><Ctrls>
		<Label Text="所属区间" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<DateTime Name="DateBegin" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<DateTime Text="2 months" Name="DateEnd" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<TAB/>
		<ComboBox Items="可编辑|审核中|发布中" Name="InServicePrl" Size="80,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0"/>
		<TextBox Text="" Name="TB_code_rmprl" ReadOnly="false" Size="30,20" Visible="false" Enabled="false">
			<DbDetails>
				<DbTable/>
				<Index/>
				<Data/>
				<Order/>
				<Where>where id_roomType=%{TB_code_rmtp}</Where>
				<queryFormat>select id from creator.ctu_roompricelist %{where} order by id desc limit 0,1</queryFormat> 
				</DbDetails>
			<OnEnChange><if cond="%{TB_code_rmprl}"><DbDetails/><submit next="rmprilst" namelist="DbDetails" method="post"/>
			<else/><submit next="rmprilst" method="post" function="resetcontent"/></if></OnEnChange>
			</TextBox>       
		<BR/>
		<ListCtrl Heading="开始日期,80;结束日期,80;" Remark="Price list" Name="rmprllst" Size="600,100" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_roompricelist</DbTable>
				<Data>FROM_UNIXTIME(dt_begin,'%Y-%m-%d') as dtBegin, FROM_UNIXTIME(dt_end,'%Y-%m-%d') as dtEnd, actived, id</Data>
				<Order>order by id</Order>
				<Where>where id_roomType=%{TB_code_rmtp}</Where>
				<queryFormat>select %{data} from %{dbtable} %{where} %{order}</queryFormat> 
			</DbDetails>
			<OnClick>
				<assign name="TB_code_rmprl" function="SetText" expr="%{rmprllst[id]}"/>
				<assign name="DateBegin" function="SetText" expr="%{rmprllst[dtBegin]}"/>
				<assign name="DateEnd" function="SetText" expr="%{rmprllst[dtEnd]}"/>
				<assign name="InServicePrl" function="SetSel" expr="%{rmprllst[actived]}"/>
				<if cond="%{purview}!=127">
					<if cond="%{rmprllst[actived]}">
					<SetVisible name="update1" Visible="0"/><SetVisible name="update2" Visible="0"/>
					<else/>
					<SetVisible name="update1" Visible="1"/><SetVisible name="update2" Visible="1"/>
					</if>
				</if></OnClick>
		</ListCtrl>
		<TAB/><GroupBox Text="操作" Name="GroupBox2Child" Visible="true" Enabled="true"><Ctrls>
		<Button Text="新增" ToolTip="对所选房型创建一个价格系列的时间区间，开始入住日期至结束入住日期" Name="insert1" Size="80,20" Visible="true" Enabled="true">
			<OnClick>
			<if cond="!%{TB_name_rmtp}"><alert next="TB_name_rmtp" expr="%{lb_name}不能为空"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_roompricelist (id_roomType, dt_begin, dt_end) values(%{TB_code_rmtp},UNIX_TIMESTAMP('%{DateBegin}'),UNIX_TIMESTAMP('%{DateEnd}'))</queryFormat></DbDetails><submit next="insert1" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="TB_code_rmprl" namelist="DbDetails" method="post"/>
			<submit next="search1" method="post" function="click"/>
			</if></OnClick></Button>
		<TAB/>
		<Button Text="刷新" Name="search1" Size="80,20" Visible="true" Enabled="true">
			<OnClick><DbDetails/><submit next="rmprllst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
		<Button Text="修改" ToolTip="修改所选择价格系列的时间区间，开始入住日期至结束入住日期" Name="update1" Size="80,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><queryFormat>Update creator.ctu_roompricelist set id_roomType='%{TB_code_rmtp}',dt_begin=UNIX_TIMESTAMP('%{DateBegin}'),dt_end=UNIX_TIMESTAMP('%{DateEnd}'),actived=%{InServicePrl[SelectedIndex]} where id=%{TB_code_rmprl}</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
				<assign name="ChangeId" expr="%{ChangeId}+1"/><submit next="search1" method="post" function="click"/></OnClick></Button>
			</Ctrls></GroupBox>
		</Ctrls></GroupBox>

		<BR autoheight="1"/>
		<GroupBox Text="客房价格" Name="GroupBox3" Visible="true" Enabled="true"><Ctrls>
		<Label Text="价格(周日~周六)" Name="lb_name" Size="100,20" Visible="true" Enabled="true"/>
		<TextBox Text="" tooltip="为方便修改，当周日价格变动时后面价格跟随变化，当编辑周一~周四、周六价格是其它无影响，编辑周五价格时周六随周五联动，" Name="TB_Price_0" ReadOnly="false" Number="1" Size="50,20" Visible="true" Enabled="true">
			<OnEnChange>
				<assign name="TB_Price_1" function="SetText" expr="%{TB_Price_0}"/>
				<assign name="TB_Price_2" function="SetText" expr="%{TB_Price_0}"/>
				<assign name="TB_Price_3" function="SetText" expr="%{TB_Price_0}"/>
				<assign name="TB_Price_4" function="SetText" expr="%{TB_Price_0}"/>
				<assign name="TB_Price_5" function="SetText" expr="%{TB_Price_0}"/>
				<assign name="TB_Price_6" function="SetText" expr="%{TB_Price_0}"/>
				</OnEnChange></TextBox>
		<TextBox Text="" Name="TB_Price_1" ReadOnly="false" Number="1" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_Price_2" ReadOnly="false" Number="1" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_Price_3" ReadOnly="false" Number="1" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_Price_4" ReadOnly="false" Number="1" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_Price_5" ReadOnly="false" Number="1" Size="50,20" Visible="true" Enabled="true">
			<OnEnChange>
				<assign name="TB_Price_6" function="SetText" expr="%{TB_Price_5}"/>
				</OnEnChange></TextBox>
		<TextBox Text="" Name="TB_Price_6" ReadOnly="false" Number="1" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_code_rmpri" ReadOnly="false" Number="1" Size="30,20" Visible="false" Enabled="false">
				<DbDetails>
				<DbTable/>
				<Index/>
				<Data/>
				<Order/>
				<Where>where id_roomPriceList=%{TB_code_rmprl}</Where>
				<queryFormat>select id from creator.ctu_roompricelistitem %{where} order by id desc limit 0,1</queryFormat> 
				</DbDetails>
			</TextBox>       
		
		<BR/>
		<ListCtrl Heading="星期天,80;星期一,80;星期二,80;星期三,80;星期四,80;星期五,80;星期六,80;" Remark="Price Item list" Name="rmprilst" Size="600,100" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_roompricelistitem</DbTable>
				<Data>Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, actived, id</Data>
				<Order>order by id</Order>
				<Where>where id_roomPriceList=%{TB_code_rmprl}</Where>
				<queryFormat>select %{data} from %{dbtable} %{where} %{order}</queryFormat> 
			</DbDetails>
			<OnClick>
				<assign name="TB_code_rmpri" function="SetText" expr="%{rmprilst[id]}"/>
				<assign name="TB_Price_0" function="SetText" expr="%{rmprilst[Sunday]}"/>
				<assign name="TB_Price_1" function="SetText" expr="%{rmprilst[Monday]}"/>
				<assign name="TB_Price_2" function="SetText" expr="%{rmprilst[Tuesday]}"/>
				<assign name="TB_Price_3" function="SetText" expr="%{rmprilst[Wednesday]}"/>
				<assign name="TB_Price_4" function="SetText" expr="%{rmprilst[Thursday]}"/>
				<assign name="TB_Price_5" function="SetText" expr="%{rmprilst[Friday]}"/>
				<assign name="TB_Price_6" function="SetText" expr="%{rmprilst[Saturday]}"/>
				<assign name="InServicepri" function="SetSel" expr="%{rmprilst[actived]}"/>
				</OnClick>
		</ListCtrl>
		<TAB/><GroupBox Text="操作" Name="GroupBox3Child" Visible="true" Enabled="true"><Ctrls>
		<Button Text="新增" ToolTip="对所选房型的所选择的价格系列的时间区间，设定价格表，周日至周六的在这个时间段该房型对应价格" Name="insert2" Size="80,20" Visible="true" Enabled="true">
			<OnClick>
			<if cond="!%{TB_name_rmtp}"><alert next="TB_name_rmtp" expr="%{lb_name}不能为空"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_roompricelistitem (id_roomPriceList,Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday) values(%{TB_code_rmprl},%{TB_Price_0},%{TB_Price_1},%{TB_Price_2},%{TB_Price_3},%{TB_Price_4},%{TB_Price_5},%{TB_Price_6})</queryFormat></DbDetails><submit next="insert2" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="TB_code_rmpri" namelist="DbDetails" method="post"/>
			<submit next="search2" method="post" function="click"/>
			</if></OnClick></Button>
		<TAB/>
		<Button Text="刷新" Name="search2" Size="80,20" Visible="true" Enabled="true">
			<OnClick><DbDetails/><submit next="rmprilst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
		<Button Text="修改" ToolTip="对所选房型的所选择的价格系列的时间区间的价格表进行修改，周日至周六的在这个时间段该房型对应价格" Name="update2" Size="80,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><queryFormat>Update creator.ctu_roompricelistitem set Sunday=%{TB_Price_0}, Monday=%{TB_Price_1}, Tuesday=%{TB_Price_2}, Wednesday=%{TB_Price_3}, Thursday=%{TB_Price_4}, Friday=%{TB_Price_5}, Saturday=%{TB_Price_6} where id=%{TB_code_rmpri}</queryFormat></DbDetails><submit next="update" namelist="DbDetails" method="post"/>
				<assign name="ChangeId" expr="%{ChangeId}+1"/><submit next="search2" method="post" function="click"/></OnClick></Button>

			</Ctrls></GroupBox>
		</Ctrls></GroupBox>
			
	</Ctrls>
	<OnActivate>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails"/></if></OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\rooms.xml" Text="客房信息" Name="rooms">
	<var name="hotelid" expr="0"/>
	<var name="rmtpChg" expr="0"/>
	<Ctrls>
		<GroupBox Text="客房信息" Name="GroupBox1" Visible="true" Enabled="true"><Ctrls>
		<Label Text="房间号" Name="lb_roomno" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_roomno" ReadOnly="false" Size="30,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="房间类型" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="init" Name="CB_roomTpye" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="1">
			<DbDetails>
			<queryFormat>select roomtype,roomtypeid from creator.ctu_roomtype where hotel_id=%{hotelid}</queryFormat> 
			</DbDetails></ComboBox>
		<TAB/>
		<Label Text="房间状态" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="init" Name="CB_roomStatus" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
				<queryFormat>select status_cn,id from creator.ctu_roomstatus</queryFormat> 
				</DbDetails></ComboBox>
		<Label Text="编号" Name="lb_code" Size="30,20" Visible="false" Enabled="true"/>
		<TextBox Text="" Name="TB_code_rmtp" ReadOnly="false" Size="30,20" Visible="false" Enabled="false">
			<DbDetails>
				<DbTable/>
				<Index/>
				<Data/>
				<Order/>
				<Where>where hotel_id=%{hotelid}</Where>
				<queryFormat>select roomid from creator.ctu_rooms %{where} order by roomid desc limit 0,1</queryFormat> 
				</DbDetails>
			</TextBox>       
		<BR/>
		<Label Text="房间概况" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_detail_rmtp" ReadOnly="false" Size="500,20" Visible="true" Enabled="true"/>
		<TAB/>
		<BR/>
		<ListCtrl Heading="房间号码,50;房型ID,50;房型名,50;房间概况,100;房间状态,20;开始时间,80; 结束时间,80;" Name="rmtplst" Size="600,500" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_rooms r inner join creator.ctu_roomstatus s on r.roomstatus=s.id</DbTable>
				<Data>r.roomno, r.roomtypeid, r.roomname, r.description, s.status_cn, FROM_UNIXTIME(r.checkindt,'%Y-%m-%d %H:%i') as indt,FROM_UNIXTIME(r.checkoutdt,'%Y-%m-%d %H:%i') as outdt,r.roomid</Data>
				<Order>order by roomid</Order>
				<Where>where hotel_id=%{hotelid}</Where>
				<queryFormat>select %{data} from %{dbtable} %{where} %{order}</queryFormat> 
			</DbDetails>
			<OnClick>
				<assign name="TB_code_rmtp" function="SetText" expr="%{rmtplst[roomid]}"/>
				<assign name="TB_roomno" function="SetText" expr="%{rmtplst[roomno]}"/>
				<assign name="TB_detail_rmtp" function="SetText" expr="%{rmtplst[description]}"/>
				<assign name="CB_roomTpye" function="SetSel" expr="%{rmtplst[roomname]}"/>
				<assign name="CB_roomStatus" function="SetSel" expr="%{rmtplst[status_cn]}"/>
				<if cond="%{rmtplst[actived]}"><SetVisible name="GroupBox1Child" Visible="0"/><else/><SetVisible name="GroupBox1Child" Visible="1"/></if>
				</OnClick>
		</ListCtrl>
		<TAB/><GroupBox Text="操作" Name="GroupBoxChild" Visible="true" Enabled="true"><Ctrls>
		<Button Text="新增" ToolTip="创建一个房间供客人入住，设定房间号、房型、房间状态、房间概况等参数" Name="insert" Size="30,20" Visible="true" Enabled="true">
			<OnClick>
			<if cond="!%{TB_roomno}"><alert next="TB_roomno" expr="%{lb_roomno}不能为空"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_rooms (hotel_id, roomno, roomtypeid, roomname, description, roomstatus) values(%{hostels.TB_code},'%{TB_roomno}',%{CB_roomTpye[roomtypeid]},'%{CB_roomTpye[roomtype]}','%{TB_detail_rmtp}',1)</queryFormat></DbDetails><submit next="insert" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="TB_code_rmtp" namelist="DbDetails" method="post"/><submit next="rmtplst" namelist="DbDetails"/>
			</if></OnClick></Button>
		<TAB/>
		<Button Text="修改" ToolTip="修改所选房间的参数，可修改房间号、房型、房间状态、房间概况等参数" Name="update" Size="30,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><queryFormat>Update creator.ctu_rooms set roomno='%{TB_roomno}', roomtypeid=%{CB_roomTpye[roomtypeid]}, roomname='%{CB_roomTpye[roomtype]}', description='%{TB_detail_rmtp}' where roomid=%{TB_code_rmtp}</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails"/></OnClick></Button>
		<BR/>
		<Button Text="刷新" Name="search" Size="30,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><where>where hotel_id=%{hotelid}</where></DbDetails><submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<TAB/>
		<Button Text="空房" ToolTip="将所选择的房间置为空房，多在客房打扫完毕操作" Name="update1" Size="30,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><queryFormat>Update creator.ctu_rooms set roomstatus=1 where roomid=%{TB_code_rmtp}</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails"/></OnClick></Button>
			</Ctrls></GroupBox>
		</Ctrls></GroupBox>
	</Ctrls>
	<OnActivate>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<if cond="%{rmtpChg}!=%{roomtype.ChangeId}">
			<assign name="rmtpChg" expr="%{roomtype.ChangeId}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<DbDetails/><submit next="rmtplst" namelist="DbDetails"/></OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\roomOccupancy.xml" Text="客房状态" Name="roomsoccupancy">
	<var name="hotelid" expr="0"/>
	<var name="rmtpChg" expr="0"/>
	<Ctrls>
		<GroupBox Text="客房占用状态" Name="GroupBox1" Size="750,550" Visible="true" Enabled="true"><Ctrls>
		<DateTime Name="DtStart" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<DateTime Name="DtEnd" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<TAB/>
		<Button Text="刷新" Name="search" Size="30,20" Visible="true" Enabled="true">
			<OnClick><DbDetails/>
			<submit next="rmStDtl" namelist="DbDetails"/>
			</OnClick>
			</Button>
		<TAB/>
		<ComboBox OnLoad="init" Name="CB_roomTpye" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
				<queryFormat>select roomtype,roomtypeid,num from creator.ctu_roomtype where hotel_id=%{hotelid}</queryFormat> 
				</DbDetails>
			<OnSELENDOK>
				<assign name="TB_num_rmtp" function="SetText" expr="%{CB_roomTpye[num]}"/>
				</OnSELENDOK></ComboBox>
		<Label Text="房间总数" Name="lb_num" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_num_rmtp" ReadOnly="false" Size="50,20" Visible="true" Enabled="false"/>

		<BR/>
		<ListCtrl Remark="Price Detail list" Name="rmStDtl" Size="720,500" Visible="true" Enabled="true">
			<DbDetails>
				<Data>
				  <Data Dynamic="true">sql:select FROM_UNIXTIME(dt,'%Y-%m-%d') as dt from creator.ctu_roomrates where hotel_id=%{hotelid} and dt between UNIX_TIMESTAMP('%{DtStart}') and UNIX_TIMESTAMP('%{DtEnd}') group by dt;</Data> 
				  <DataFormat>max(getRoomStatus(roomid,UNIX_TIMESTAMP('%{dt}'))) as '%{dt}'</DataFormat> 
				  </Data>
				<DbTable>creator.ctu_rooms</DbTable>
				<Order/>
				<Where>where hotel_id=%{hotelid}</Where>
				<queryFormat>select distinct(roomid) as 序号,max(roomno) as 房号,roomname as 房型, %{data} from %{dbtable} %{where} group by roomid</queryFormat> 
			</DbDetails>
		</ListCtrl>
		</Ctrls></GroupBox>
	</Ctrls>
	<OnActivate>
		<assign name="DtEnd" expr="1 weeks"/>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<if cond="%{rmtpChg}!=%{roomtype.ChangeId}">
			<assign name="rmtpChg" expr="%{roomtype.ChangeId}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<submit next="search" method="post" function="click"/></OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\roomStatus.xml" Text="房型状态" Name="roomstatus">
	<var name="hotelid" expr="0"/>
	<var name="rmtpChg" expr="0"/>
	<Ctrls>
		<GroupBox Text="客房可售状态" Name="GroupBox1" Visible="true" Enabled="true"><Ctrls>
		<DateTime Name="DtStart" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<DateTime Name="DtEnd" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<TAB/>
		<ComboBox OnLoad="init" Name="CB_roomTpye" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
				<queryFormat>select roomtype,roomtypeid,num from creator.ctu_roomtype where hotel_id=%{hotelid}</queryFormat> 
				</DbDetails>
			<OnSELENDOK>
				<assign name="TB_num_rmtp" function="SetText" expr="%{CB_roomTpye[num]}"/>
				</OnSELENDOK></ComboBox>
		<Label Text="房间总数" Name="lb_num" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_num_rmtp" ReadOnly="false" Size="50,20" Visible="true" Enabled="false"/>
		<Button Text="开通预定" Tooltip="选择开通预定的入住起始日期、退房结束日期，房型，然后点击“开通预定”即可" Name="openResv" Size="50,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><queryFormat>select openReserv(UNIX_TIMESTAMP('%{DtStart}'),UNIX_TIMESTAMP('%{DtEnd}'),%{hostels.TB_code},%{CB_roomTpye[roomtypeid]},'%{CB_roomTpye[roomtype]}',%{CB_roomTpye[num]},%{user_id})</queryFormat></DbDetails>
				<submit next="openResv" namelist="DbDetails" method="post"/>
				<submit next="search" method="post" function="click"/></OnClick>
			</Button>
		<TAB/><TAB/><TAB/><Button Text="刷新" Name="search" Size="30,20" Visible="true" Enabled="true">
			<OnClick><DbDetails/>
			<submit next="rmtplst" namelist="DbDetails" method="post"/>
			<submit next="rmPrDtl" namelist="DbDetails"/>
			<submit next="rmPrDtlToday" namelist="DbDetails"/>
			<submit next="rmStDtl" namelist="DbDetails"/>
			</OnClick>
			</Button>
	     <Button Text="导出" Name="export" Size="30,20">
		<OnClick>	<Save/><submit next="rmPrDtl" namelist="Save" method="post" function="savetofile"/></OnClick></Button>
		<BR/>
		<ListCtrl DataJoin="%{this}%{rmTpSt}" Name="rmtplst" autosizecol="1" Size="720,90" Visible="true" Enabled="true">
			<MDX remark="房间预定状态" id="rmTpSt">
			<DbDetails>
				<DbTable>creator.ctu_roomrates</DbTable>
				<Index>o_id</Index>
				<MDX>序号,日期,cnts</MDX>
				<Data>roomtp_id as 序号,FROM_UNIXTIME(dt,'%Y-%m-%d') as 日期,(numTotal-numBooking-numReserved) as cnts</Data>
				<Order>s_order.o_id desc</Order>
				<Where>hotel_id=%{hotelid} and dt &gt;= UNIX_TIMESTAMP('%{DtStart}') and dt &lt; UNIX_TIMESTAMP('%{DtEnd}')</Where>
				<queryFormat>select %{data} from %{dbtable} where %{where}</queryFormat> 
			</DbDetails>
			</MDX>			
			<DbDetails>
				<DbTable>creator.ctu_roomtype</DbTable>
				<Data>roomtypeid as 序号, roomtype as 房型</Data>
				<Order>order by roomtypeid</Order>
				<Where>where hotel_id=%{hotelid}</Where>
				<queryFormat>select %{data} from %{dbtable} %{where} %{order}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		</Ctrls></GroupBox>

		<BR autoheight="1"/>
		<GroupBox Text="客房价格表" Name="GroupBox2" Visible="true" Enabled="true"><Ctrls>
		<ListCtrl Remark="Price Detail list" Name="rmPrDtl" autosizecol="1" Size="720,90" Visible="true" Enabled="true">
			<DbDetails>
				<Data>
				  <Data Dynamic="true">sql:select FROM_UNIXTIME(dt,'%Y-%m-%d') as dt from creator.ctu_roomrates where hotel_id=%{hotelid} and dt &gt;= UNIX_TIMESTAMP('%{DtStart}') and dt &lt; UNIX_TIMESTAMP('%{DtEnd}') group by dt;</Data> 
				  <DataFormat>max(getRoomPrice(roomtp_id,'%{dt}')) as '%{dt}'</DataFormat> 
				  </Data>
				<DbTable>creator.ctu_roomrates</DbTable>
				<Order/>
				<Where>where hotel_id=%{hotelid} and dt &gt;= UNIX_TIMESTAMP('%{DtStart}') and dt &lt; UNIX_TIMESTAMP('%{DtEnd}')</Where>
				<queryFormat>select distinct(roomtp_id) as 序号,max(roomtp_name) as 房型,%{data} from %{dbtable} %{where} group by roomtp_id</queryFormat> 
			</DbDetails>
		</ListCtrl></Ctrls></GroupBox>

		<BR autoheight="1"/>
		<GroupBox Text="今日房价" Name="GroupBox3" Visible="true" Enabled="true"><Ctrls>
		<ListCtrl Heading="房型,20;门市价,80;E网络会员价,80;普卡会员价,80;金卡会员价,80;铂金会员价,80;" Remark="Price Detail list" Name="rmPrDtlToday" Size="720,90" Visible="true" Enabled="true">
			<DbDetails>
				<Data>x.name,x.pr,CEIL(x.pr*0.95),CEIL(x.pr*0.92),CEIL(x.pr*0.88),CEIL(x.pr*0.85)</Data>
				<DbTable>(select distinct(roomtp_id) as id,max(roomtp_name) as name,MAX(getRoomPrice(roomtp_id,CURDATE())) as pr from creator.ctu_roomrates where hotel_id=%{hotelid} group by id) as x</DbTable>
				<Order/>
				<Where>where hotel_id=%{hotelid} and dt &gt;= UNIX_TIMESTAMP('%{DtStart}') and dt &lt; UNIX_TIMESTAMP('%{DtEnd}')</Where>
				<queryFormat>select %{data} from %{dbtable}</queryFormat> 
			</DbDetails>
		</ListCtrl></Ctrls></GroupBox>
		
		<BR autoheight="1"/>
		<GroupBox Text="客房预定状态明细" Name="GroupBox4" Visible="true" Enabled="true"><Ctrls>
		<ListCtrl Heading="序号,20;房型编号,20;房型,50;日期,80;总数,20;预订数,20;保留数,20;取消数,20;负责人,50" Remark="Status Detail list" Name="rmStDtl" Size="720,160" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_roomrates</DbTable>
				<Data>rate_id, roomtp_id, roomtp_name, FROM_UNIXTIME(dt,'%Y-%m-%d') as dt, numTotal, numBooking, numReserved, numCanceled, executives</Data>
				<Order>order by dt,roomtp_id</Order>
				<Where>where hotel_id=%{hotelid} and dt &gt;= UNIX_TIMESTAMP('%{DtStart}') and dt &lt; UNIX_TIMESTAMP('%{DtEnd}')</Where>
				<queryFormat>select %{data} from %{dbtable} %{where} %{order}</queryFormat> 
			</DbDetails>
		</ListCtrl></Ctrls></GroupBox>
	</Ctrls>
	<OnActivate>
		<assign name="DtEnd" expr="1 weeks"/>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<if cond="%{rmtpChg}!=%{roomtype.ChangeId}">
			<assign name="rmtpChg" expr="%{roomtype.ChangeId}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<submit next="search" method="post" function="click"/></OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\resv.xml" Text="预订信息" Name="resv">
	<var name="hotelid" expr="0"/>
	<var name="rmtpChg" expr="0"/>
	<Ctrls>
		<GroupBox Text="预订信息" Name="GroupBox1" Size="750,600" Visible="true" Enabled="true"><Ctrls>
		<Label Text="客人姓名" Name="lb_custName" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_custName" ReadOnly="false" Size="60,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="房间类型" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_roomTpye" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="-1">
			<DbDetails>
			<queryFormat>select roomtype,roomtypeid from creator.ctu_roomtype where hotel_id=%{hotelid}</queryFormat> 
			</DbDetails>
			<OnSELENDOK><if cond="%{CB_resvStatus[id]}==1"><if cond="%{CB_roomTpye}">
				<DbDetails/><submit next="CB_roomAvlb" namelist="DbDetails" method="post"/></if>
				<else/><submit next="CB_roomAvlb" method="post" function="resetcontent"/></if>
				</OnSELENDOK>
				</ComboBox>
		<TAB/>
		<Label Text="预定状态" Name="lb_resvStatus" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="init" Name="CB_resvStatus" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
				<queryFormat>select nameCN,id from creator.ctu_resvstatus</queryFormat> 
				</DbDetails></ComboBox>
		<Label Text="支付状态" Name="lb_payStatus" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="init" Name="CB_payStatus" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
				<queryFormat>select nameCN,id from creator.ctu_paystatus</queryFormat> 
				</DbDetails></ComboBox>
		<Label Text="编号" Name="lb_code" Size="30,50" Visible="false" Enabled="true"/>
		<TextBox Text="" Name="TB_code_resv" ReadOnly="false" Size="30,20" Visible="false" Enabled="false">
				<OnEnChange><if cond="%{TB_code_resv}"><DbDetails/><submit next="billdetail" namelist="DbDetails"/>
				<else/><submit next="billdetail" method="post" function="resetcontent"/></if>
				</OnEnChange></TextBox>
		<TAB/>
		<BR/>
		<Label Text="客人要求" Name="lb_demand" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_demand" ReadOnly="false" Size="500,20" Visible="true" Enabled="true"/>
		<TAB/>
		<BR/>
		<ListCtrl filtering="1,预定,预定,0" Heading="客人姓名,20;状态,80;电话,80;邮件,80;订单总价,80;预定时间,100;预计入住,80;预计退房,80;房号,80;天数,80;房价明细,100;预定方式,80" Name="rmtplst" OnClick="SetText(TB_code_resv,%{reservation_id});SetSel(CB_resvStatus,%{status});SetText(TB_custName,%{custName});SetText(TB_demand,%{custDemand});SetSel(CB_roomTpye,%{roomtypename});SetSel(CB_payStatus,%{payStatus})" Size="600,500" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_reservation</DbTable>
				<Data>custName,getResvStatusName(status) as status,phone,custEmail,billTotal,FROM_UNIXTIME(reserved_date,'%Y-%m-%d %H:%i') as reserved_dt,FROM_UNIXTIME(checkindate,'%Y-%m-%d') as checkin, FROM_UNIXTIME(checkoutdate,'%Y-%m-%d') as checkout, roomno,cast((checkoutdate-checkindate)/86400 as SIGNED) as days,billDetail,src,roomtypename, agentid,reservation_id,guestid,book_id,roomtypeid, confirmed_by,confirmed_date,getPayStatusName(payStaus) as payStatus,custDemand</Data>
				<Order>order by reservation_id</Order>
				<queryFormat>select %{data} from %{dbtable} where hotel_id=%{hotelid} %{where} %{order}</queryFormat> 
			</DbDetails>
			<OnClick>
				<assign name="TB_code_resv" function="SetText" expr="%{rmtplst[reservation_id]}"/>
				<assign name="CB_resvStatus" function="SetSel" expr="%{rmtplst[status]}"/>
				<assign name="TB_custName" function="SetText" expr="%{rmtplst[custName]}"/>
				<assign name="TB_demand" function="SetText" expr="%{rmtplst[custDemand]}"/>
				<assign name="CB_roomTpye" function="SetSel" expr="%{rmtplst[roomtypename]}"/>
				<assign name="CB_payStatus" function="SetSel" expr="%{rmtplst[payStatus]}"/>
			</OnClick>
		</ListCtrl>
		<TAB/><GroupBox Text="查询" Name="GBSearchs" Visible="true" Enabled="true"><Ctrls>
		<DateTime Name="DtStart" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<BR/>
		<DateTime Text="4 day" Name="DtEnd" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<BR/>
		<Button Text="查找" ToolTip="查询所选择的时间段预定订单" Name="search" Size="30,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where>and checkindate between UNIX_TIMESTAMP('%{DtStart}') and UNIX_TIMESTAMP('%{DtEnd}')</Where></DbDetails>
			<submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
		<Button Text="今日入住" ToolTip="查询预定今日入住订单" Name="searchToday" Size="50,20" Visible="true" Enabled="true">
			<OnClick>
				<DbDetails><Where>and checkindate = UNIX_TIMESTAMP(CURDATE())</Where></DbDetails>
				<submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<TAB/>
		<Button Text="今日预定" ToolTip="查询今日预定订单" Name="searchLatest" Size="50,20" Visible="true" Enabled="true">
			<OnClick>
				<DbDetails><Where>and reserved_date between UNIX_TIMESTAMP(CURDATE()) and UNIX_TIMESTAMP(CURDATE())+86400</Where></DbDetails>
				<submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button></Ctrls></GroupBox>
		<BR Size="610,180"/><TAB/><GroupBox Text="操作" Name="GBAction" Visible="true" Enabled="true"><Ctrls>
		<Button Text="确认预定" ToolTip="该操作表示门店知晓该预定，不需再次提醒。" Name="confirm" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{CB_resvStatus[id]}==1">
			<DbDetails><queryFormat>update creator.ctu_reservation set confirmed_date=UNIX_TIMESTAMP(),confirmed_by='%{user_id}' where reservation_id='%{rmtplst[reservation_id]}'</queryFormat></DbDetails><submit next="confirm" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		<BR Size="0,25"/>
 		<Button Text="置失效" ToolTip="该操作将改变所选订单为失效状态。" Name="expired" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{CB_resvStatus[id]}==1">
			<DbDetails><queryFormat>update creator.ctu_reservation set status=5 where reservation_id='%{rmtplst[reservation_id]}'</queryFormat></DbDetails><submit next="expired" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
 		<Button Text="置取消" ToolTip="该操作将改变所选订单为取消状态。" Name="canceled" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{CB_resvStatus[id]}==1">
			<DbDetails><queryFormat>update creator.ctu_reservation set status=2 where reservation_id='%{rmtplst[reservation_id]}'</queryFormat></DbDetails><submit next="canceled" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		<BR/>
		<Label Text="可用房间" Name="lb_roomno" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_roomAvlb" Size="60,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
			<queryFormat>select roomno,roomid,getRoomPrice(%{CB_roomTpye[roomtypeid]},CURDATE()) as price,description from creator.ctu_rooms where roomtypeid=%{CB_roomTpye[roomtypeid]} and roomstatus=1</queryFormat> 
			</DbDetails>
			<OnSELENDOK>
			<assign name="TB_desc" expr="%{CB_roomAvlb[description]}"/>
			<assign name="TB_price" expr="%{CB_roomAvlb[price]}"/>
				</OnSELENDOK>
			</ComboBox>
		<BR/>
		<TextBox tooltip="房间信息" Name="TB_desc" ReadOnly="true" Size="100,50" Visible="true" Enabled="true"/>
		<BR autoheight="1"/>
		<TextBox tooltip="门市价" Name="TB_price" ReadOnly="true" Size="100,20" Visible="true" Enabled="true"/>
		<BR/>
		<TextBox tooltip="入住押金" Name="TB_deposit" ReadOnly="false" Number="1" Size="60,20" Visible="true" Enabled="true"/>
		<Button Text="预收押金" ToolTip="若客人办理入住需收取押金，在“入住押金”输入相应金额后“预收押金”。" Name="deposit" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="!%{TB_deposit}"><alert next="deposit" expr="押金不能为空"/>
			<elseif cond="!%{rmtplst[guestid]}"/><alert next="deposit" expr="客人信息不正确"/>
			<elseif cond="!%{rmtplst[reservation_id]}"/><alert next="deposit" expr="订单信息不正确"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_billdetails (itemid, user_id, resvation_id,hotel_id,expense, itype, created_by, created_dt) values(16,'%{rmtplst[guestid]}','%{rmtplst[reservation_id]}',%{hostels.TB_code},%{TB_deposit}*100,0,'%{user_id}',UNIX_TIMESTAMP())</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="billdetail" namelist="DbDetails"/></if></OnClick></Button>
 		<BR/><ListCtrl Heading="类别,80;金额,80;时间,80;操作员,80" Name="billdetail" Size="120,80" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_billdetails as b inner join creator.ctu_user as u on b.created_by=u.user_id inner join creator.ctu_billtypes as t on t.itemid=b.itemid</DbTable>
				<Data>itemCN,expense/100 as expense,FROM_UNIXTIME(created_dt,'%Y-%m-%d %H:%i') as dt,user_loginname</Data>
				<Order>order by dt</Order>
				<queryFormat>select %{data} from %{dbtable} where resvation_id='%{TB_code_resv}' %{where} %{order}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		<BR autoheight="1"/>
		<Button Text="办理入住" ToolTip="根据所选订单选择可用房间方可办理入住。" Name="insert" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{CB_resvStatus[id]}==1">
			<if cond="!%{CB_roomAvlb[roomid]}"><alert next="CB_roomAvlb" expr="%{lb_roomno}不能为空"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_bookin (hotel_id, roomid,roomNo, roomtypeid,roomType,reservation_id,guestid,custName,checkindate,checkoutdate,checkedin_date,checkedin_by) values(%{hostels.TB_code},'%{CB_roomAvlb[roomid]}','%{CB_roomAvlb[roomno]}',%{CB_roomTpye[roomtypeid]},'%{CB_roomTpye[roomtype]}','%{rmtplst[reservation_id]}','%{rmtplst[guestid]}','%{rmtplst[custName]}',UNIX_TIMESTAMP('%{rmtplst[checkin]}'),UNIX_TIMESTAMP('%{rmtplst[checkout]}'),UNIX_TIMESTAMP(),'%{user_id}')</queryFormat></DbDetails><submit next="insert" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/><submit next="CB_roomAvlb" method="post" function="resetcontent"/>
			</if><else/><if cond="%{CB_resvStatus[id]}==7"><alert next="CB_roomAvlb" expr="预留订单请在门店预留入住办理入住"/><else/><alert next="CB_roomAvlb" expr="非预定状态订单不能办理入住"/></if></if></OnClick></Button>
			</Ctrls></GroupBox>
		</Ctrls></GroupBox>
 		<ListCtrl Text="最新预定" Name="resvNew" ReadOnly="false" NULLChanged="1" Size="30,20" Visible="false" Enabled="false">
			<DbDetails>
				<queryFormat>select custName,roomtypename from creator.ctu_reservation where hotel_id=%{hotelid} and confirmed_by=0 and status=1 and checkindate &gt;= UNIX_TIMESTAMP(CURDATE()) order by reservation_id desc limit 0,3</queryFormat> 
			</DbDetails></ListCtrl>
		<Button Text="最新预定" Name="searchResvNew" Size="50,20" Visible="false" Enabled="true">
			<OnClick><DbDetails/><submit next="resv.resvNew" namelist="DbDetails"/></OnClick></Button>
	</Ctrls>
	<OnActivate><DbDetails/>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<if cond="%{rmtpChg}!=%{roomtype.ChangeId}">
			<assign name="rmtpChg" expr="%{roomtype.ChangeId}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<submit next="search" method="post" function="click"/></OnActivate>
	<OnChanged><if cond="%{resv.resvNew[IsDataChanged]}>0"><if cond="%{resv.resvNew[SnapShot]}"><notify next="tst" expr="您有新预定 %{resv.resvNew[SnapShot]}"/></if></if>
		</OnChanged>
	
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\bookin.xml" Text="入住信息" Name="bookin">
	<var name="hotelid" expr="0"/>
	<var name="rmtpChg" expr="0"/>
	<Ctrls>
		<GroupBox Text="入住信息" Name="GroupBox1" Size="750,600" Visible="true" Enabled="true"><Ctrls>
		<Label Text="客人姓名" Name="lb_custName" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_custName" ReadOnly="false" Size="60,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="房间类型" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_roomTpye" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="-1">
			<DbDetails>
			<queryFormat>select roomtype,roomtypeid from creator.ctu_roomtype where hotel_id=%{hotelid}</queryFormat> 
			</DbDetails>
			<OnSELENDOK><if cond="%{rmtplst[checkedout_dt]}==''"><if cond="%{CB_roomTpye}">
				<DbDetails/><submit next="CB_roomAvlb" namelist="DbDetails" method="post"/></if>
				<else/><submit next="CB_roomAvlb" method="post" function="resetcontent"/></if>
				</OnSELENDOK>
				</ComboBox>
		
		<Label Text="编号" Name="lb_code" Size="30,50" Visible="false" Enabled="true"/>
		<TextBox Text="" Name="TB_code_resv" ReadOnly="false" Size="30,20" Visible="false" Enabled="false">
				<OnEnChange><if cond="%{TB_code_resv}"><DbDetails/><submit next="billdetail" namelist="DbDetails"/>
				<else/><submit next="billdetail" method="post" function="resetcontent"/></if>
				</OnEnChange></TextBox>       
		<BR/>
		<ListCtrl filtering="5,,0,0" Heading="客人姓名,20;房号,80;房型,80;入住员,80;入住时间,80;退房员,80;退房时间,80;预计入住,80;预计退房,80;预计天数,80;实际天数,80;" Name="rmtplst" OnClick="SetText(TB_code_resv,%{reservation_id});SetText(TB_custName,%{custName});SetText(TB_demand,%{custDemand});SetSel(CB_resvStatus,%{status});SetSel(CB_roomTpye,%{roomType});SetSel(CB_payStatus,%{payStatus})" Size="600,500" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_bookin</DbTable>
				<Data>custName,roomno,roomType,checkedin_by,FROM_UNIXTIME(checkedin_date,'%Y-%m-%d %H:%i') as checkedin_dt,checkedout_by,FROM_UNIXTIME(checkedout_date,'%Y-%m-%d  %H:%i') as checkedout_dt,FROM_UNIXTIME(checkindate,'%Y-%m-%d') as checkindt, FROM_UNIXTIME(checkoutdate,'%Y-%m-%d') as checkoutdt,(checkoutdate-checkindate)/86400 as days,SEC_TO_TIME(checkedout_date-checkedin_date) as daysReal,book_id,guestid,reservation_id, bill_id, roomid,roomtypeid, rates_id, instructions</Data>
				<Order>order by book_id</Order>
				<Where>and checkindate between UNIX_TIMESTAMP('%{DtStart}') and UNIX_TIMESTAMP('%{DtEnd}')</Where>
				<queryFormat>select %{data} from %{dbtable} where hotel_id=%{hotelid} %{where} %{order}</queryFormat> 
			</DbDetails>
			<OnClick>
				<assign name="TB_code_resv" function="SetText" expr="%{rmtplst[reservation_id]}"/>
				<assign name="CB_resvStatus" function="SetSel" expr="%{rmtplst[status]}"/>
				<assign name="TB_custName" function="SetText" expr="%{rmtplst[custName]}"/>
				<assign name="TB_demand" function="SetText" expr="%{rmtplst[custDemand]}"/>
				<assign name="CB_roomTpye" function="SetSel" expr="%{rmtplst[roomType]}"/>
				<assign name="CB_payStatus" function="SetSel" expr="%{rmtplst[payStatus]}"/>
			</OnClick>
		</ListCtrl>
		<TAB/><GroupBox Text="查询" Name="GBSearchs" Visible="true" Enabled="true"><Ctrls>
		<DateTime Name="DtStart" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<BR/>
		<DateTime Text="1 day" Name="DtEnd" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<BR/>
 		<Button Text="查找[退房]" ToolTip="查询所选时间段该退房的客人" Name="search" Size="60,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where>and checkoutdate between UNIX_TIMESTAMP('%{DtStart}') and UNIX_TIMESTAMP('%{DtEnd}')</Where></DbDetails><submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
 		<Button Text="今日在住" ToolTip="查询现在仍在住店的客人" Name="searchCheckedins" Size="50,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where>and checkedin_date &lt; UNIX_TIMESTAMP() and checkedout_date is NULL</Where></DbDetails><submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<TAB/><Button Text="今日入住" ToolTip="查询今日入住的客人" Name="searchInToday" Size="50,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where>and checkindate = UNIX_TIMESTAMP(CURDATE())</Where></DbDetails>
			<submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
		<Button Text="今日退房" ToolTip="查询今日退房的客人" Name="searchOutToday" Size="50,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where>and (checkedout_date = UNIX_TIMESTAMP(CURDATE()) or checkedout_date between UNIX_TIMESTAMP(CURDATE()) and UNIX_TIMESTAMP(CURDATE())+86400)</Where></DbDetails>
			<submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<Button Text="今日应退房" ToolTip="查询今日应该退房的客人" Name="searchOutToday" Size="60,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where>and (checkoutdate = UNIX_TIMESTAMP(CURDATE()) or checkedout_date between UNIX_TIMESTAMP(CURDATE()) and UNIX_TIMESTAMP(CURDATE())+86400)</Where></DbDetails>
			<submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button></Ctrls></GroupBox>
		<BR Size="610,200"/><TAB/><GroupBox Text="操作" Name="GBAction" Visible="true" Enabled="true"><Ctrls>
		<Label Text="可用房间" Name="lb_roomno" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_roomAvlb" Size="60,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
			<queryFormat>select roomno,roomid,getRoomPrice(%{CB_roomTpye[roomtypeid]},CURDATE()) as price,description from creator.ctu_rooms where roomtypeid=%{CB_roomTpye[roomtypeid]} and roomstatus=1</queryFormat> 
			</DbDetails>
			<OnSELENDOK>
			<assign name="TB_desc" expr="%{CB_roomAvlb[description]}"/>
			<assign name="TB_price" expr="%{CB_roomAvlb[price]}"/>
				</OnSELENDOK>
			</ComboBox>
		<BR Size="0,25"/>
		<TextBox tooltip="房间信息" Name="TB_desc" ReadOnly="true" Size="100,50" Visible="true" Enabled="true"/>
		<BR autoheight="1"/>
		<TextBox tooltip="门市价" Name="TB_price" ReadOnly="true" Size="100,20" Visible="true" Enabled="true"/>
		<BR/>
		<TextBox tooltip="金额" Name="TB_deposit" ReadOnly="false" Number="1" Size="60,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="sql:select itemCN,itemid,  item, description, sale, price, type from creator.ctu_billtypes" Name="CB_billtype" Size="60,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0"/>
		<BR/>
		<Button Text="帐务处理" ToolTip="收银或挂帐" Name="deposit" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="!%{TB_deposit}"><alert next="deposit" expr="金额不能为空"/>
			<elseif cond="!%{rmtplst[guestid]}"/><alert next="deposit" expr="客人信息不正确"/>
			<elseif cond="!%{rmtplst[reservation_id]}"/><alert next="deposit" expr="订单信息不正确"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_billdetails (itemid, user_id, resvation_id, hotel_id,expense, itype, created_by, created_dt) values(%{CB_billtype[itemid]},'%{rmtplst[guestid]}','%{rmtplst[reservation_id]}',%{hostels.TB_code},%{TB_deposit}*100,%{CB_billtype[type]},'%{user_id}',UNIX_TIMESTAMP())</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="billdetail" namelist="DbDetails"/></if></OnClick></Button>
		<TAB/><Button Text="办理换房" ToolTip="更换客人至新的房间，先选择可供入住的房间" Name="changeRoom" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{rmtplst[checkedout_dt]}==''">
			<DbDetails><queryFormat>Update creator.ctu_bookin set roomid=%{CB_roomAvlb[roomid]},roomNo='%{CB_roomAvlb[roomno]}',roomtypeid=%{CB_roomTpye[roomtypeid]},roomType='%{CB_roomTpye[roomtype]}' where book_id=%{rmtplst[book_id]}</queryFormat></DbDetails><submit next="changeRoom" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/>
			<else/><alert next="changeRoom" expr="非入住状态订单不能办理换房"/></if></OnClick></Button>
 		<BR/><ListCtrl Heading="类别,80;金额,80;时间,80;操作员,80" Name="billdetail" Size="120,80" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_billdetails as b inner join creator.ctu_user as u on b.created_by=u.user_id inner join creator.ctu_billtypes as t on t.itemid=b.itemid</DbTable>
				<Data>itemCN,expense/100 as expense,FROM_UNIXTIME(created_dt,'%Y-%m-%d %H:%i') as dt,user_loginname</Data>
				<Order>order by dt</Order>
				<queryFormat>select %{data} from %{dbtable} where resvation_id='%{TB_code_resv}' %{where} %{order}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		<BR autoheight="1"/>
		<Button Text="办理退房" ToolTip="办理客人退房，房间状态变为脏房，订单转为退房状态，此时可以结算清账了，随后点击“清账”进入“帐务处理”清账" Name="update" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{rmtplst[checkedout_dt]}==''">
			<DbDetails><queryFormat>Update creator.ctu_bookin set checkedout_date=UNIX_TIMESTAMP(),checkedout_by='%{user_id}' where book_id=%{rmtplst[book_id]}</queryFormat></DbDetails><submit next="update" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/>
			<else/><alert next="update" expr="非入住状态订单不能办理退房"/></if></OnClick></Button>
		<TAB/><Button Text="清账" ToolTip="将该订单信息及关联信息带入帐务处理结算清账" Name="gotobill" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{rmtplst[checkedout_dt]}!=''">
			<assign name="bill.TB_code_resv" expr="%{rmtplst[reservation_id]}"/><assign name="bill.TB_code_user" expr="%{rmtplst[guestid]}"/>
			<else/><alert next="update" expr="非入住状态订单不能办理退房"/></if></OnClick></Button></Ctrls></GroupBox>
		</Ctrls></GroupBox>
 </Ctrls>
	<OnActivate>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<if cond="%{rmtpChg}!=%{roomtype.ChangeId}">
			<assign name="rmtpChg" expr="%{roomtype.ChangeId}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<submit next="search" method="post" function="click"/></OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\bills.xml" Text="帐务处理" Name="bill">
	<var name="hotelid" expr="0"/>
	<var name="rmtpChg" expr="0"/>
	<Ctrls>
		<GroupBox Text="帐务信息" Name="GroupBox1" Visible="true" Enabled="true"><Ctrls>
		<Label Text="客人姓名" Name="lb_custName" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_custName" ReadOnly="false" Size="60,20" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_user as u left join creator.ctu_vip as v on u.user_id=v.userid left join creator.ctu_viplevel as l on v.viplevel=l.id</DbTable>
				<Where>where user_id=%{TB_code_user}</Where>
				<queryFormat>select u.user_login,v.viplevel,l.nameCN,l.discount from %{dbtable} %{where}</queryFormat> 
				</DbDetails>
			</TextBox>
		<TAB/>
		<Label Text="房间号" Name="lb_roomno" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_roomAvlb" Size="60,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
			<queryFormat>select roomno,roomid,getRoomPrice(%{CB_roomTpye[roomtypeid]},CURDATE()) as price,description from creator.ctu_rooms where roomtypeid=%{CB_roomTpye[roomtypeid]}</queryFormat> 
			</DbDetails>
			<OnSELENDOK><DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></OnSELENDOK>
			</ComboBox>
		<TAB/>
		<Label Text="房间类型" Name="lb_name" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_roomTpye" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="-1">
			<DbDetails>
			<queryFormat>select roomtype,roomtypeid from creator.ctu_roomtype where hotel_id=%{hotelid}</queryFormat> 
			</DbDetails>
			<OnSELENDOK><if cond="%{rmtplst[checkedout_dt]}==''"><if cond="%{CB_roomTpye}">
				<DbDetails/><submit next="CB_roomAvlb" namelist="DbDetails" method="post"/></if>
				<else/><submit next="CB_roomAvlb" method="post" function="resetcontent"/></if>
				</OnSELENDOK>
				</ComboBox>
		<Label Text="支付状态" Name="lb_payStatus" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_payStatus" ReadOnly="false" Size="60,20" Visible="true" Enabled="true">
			</TextBox>
		<TextBox Text="" Name="TB_code_bookin" ReadOnly="false" Size="1,20" Visible="false" Enabled="true">
			<OnEnChange><if cond="%{TB_code_bookin}">
				<DbDetails/><submit next="TB_custName" namelist="DbDetails" method="post"/></if></OnEnChange></TextBox>       
		<TextBox Text="" Name="TB_code_resv" ReadOnly="false" Size="30,20" Visible="true" Enabled="true">
			<OnEnChange/></TextBox>       
		<TextBox Text="" Name="TB_code_user" ReadOnly="false" Size="30,20" Visible="true" Enabled="true"/>
		<TAB/>
		<BR/>
		<Label Text="入住时间" Name="lb_demand" Size="50,20" Visible="true" Enabled="true"/>
		<DateTime Name="DtStart" Size="120,20" Visible="true" Enabled="true" Format="yyyy-MM-dd HH:mm"/>
		<Label Text="退房时间" Name="lb_demand" Size="50,20" Visible="true" Enabled="true"/>
		<DateTime Text="4 day" Name="DtEnd" Size="120,20" Visible="true" Enabled="true" Format="yyyy-MM-dd HH:mm"/>
		
 		<BR autoheight="1"/><ListCtrl sumcols="1,2" Heading="类别,80;金额(借),80;金额(贷),80;备注,160;时间,80;操作员,80" Name="billdetail" sum="0,1" Size="400,200" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_billdetails as b inner join creator.ctu_user as u on b.created_by=u.user_id inner join creator.ctu_billtypes as t on t.itemid=b.itemid</DbTable>
				<Data>itemCN,case b.itype when 0 then expense/100 else '' end as billin,case itype when 0 then '' else expense/100 end as billout,remark,FROM_UNIXTIME(created_dt,'%Y-%m-%d %H:%i') as dt,user_loginname</Data>
				<Order>order by dt</Order>
				<queryFormat>select %{data} from %{dbtable} where resvation_id='%{TB_code_resv}' %{where} %{order}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		<GroupBox Text="操作" Name="GroupBoxOp" Visible="true" Enabled="true"><Ctrls>
		<TextBox tooltip="金额" Name="TB_deposit" ReadOnly="false" Number="1" Size="60,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="sql:select itemCN,itemid,  item, description, sale, price, type from creator.ctu_billtypes" Name="CB_billtype" Size="80,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0"/>
		<BR/>
		<Button Text="帐务处理" ToolTip="收银或挂帐" Name="deposit" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="!%{TB_deposit}"><alert next="deposit" expr="金额不能为空"/>
			<elseif cond="!%{TB_code_user}"/><alert next="deposit" expr="客人信息不正确"/>
			<elseif cond="!%{TB_code_resv}"/><alert next="deposit" expr="订单信息不正确"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_billdetails (itemid, user_id, resvation_id,hotel_id,expense, itype, created_by, created_dt) values(%{CB_billtype[itemid]},'%{TB_code_user}','%{TB_code_resv}',%{hostels.TB_code},%{TB_deposit}*100,%{CB_billtype[type]},'%{user_id}',UNIX_TIMESTAMP())</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="billdetail" namelist="DbDetails"/></if></OnClick></Button>
			</Ctrls></GroupBox>
		</Ctrls></GroupBox>
 </Ctrls>
	<OnActivate>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<submit next="CB_roomTpye"/></if>
			<if cond="%{TB_code_resv}">
			<DbDetails/><submit next="billdetail" namelist="DbDetails" method="post"/><submit next="TB_custName" namelist="DbDetails" method="post"/></if></OnActivate>
</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\Reception.xml" Text="门店预留入住" Name="reception">
	<var name="hotelid" expr="0"/>
	<var name="uiChged" expr="0"/>
	<var name="ueChged" expr="0"/>
	<var name="newUser" expr="0"/>
	<Ctrls>
		<GroupBox Text="客人信息" Name="GroupBox1" Size="100,100" Visible="true" Enabled="true"><Ctrls>
		<TextBox Text="" Name="TB_code" ReadOnly="false" NULLChanged="1" Size="3,20" Visible="false" Enabled="true"> 
			<OnEnChange><if cond="%{newUser}"><if cond="%{TB_code}"><alert next="TB_code" expr="添加客人成功"/><else/><alert next="TB_code" expr="添加客人失败"/></if></if>
			<assign name="newUser" expr="0"/></OnEnChange>
			<OnChanged><if cond="%{users.TB_code[LastSqlErrCode]}>0"><notify next="tst" expr="%{users.TB_code[LastSqlErrMsg]}"/><if cond="%{users.TB_code[SnapShot]}"/></if>
		</OnChanged>			</TextBox>
		<TAB/>
		<Label Location="30,30" Text="散客入住可先输入手机号码或身份证号码查询,新添加客人的用户名未指定时自动生成,可查. 密码默认为身份证号码后六位, * 项为必填" Name="lb_name" Size="600,50" Visible="true" Enabled="true"/>		
		<BR Size="30,0"/><BR Size="30,0"/>
		<Label Text="用户名" Name="lb_name" Size="40,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_name" ReadOnly="false" Size="80,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="姓名*" Name="lb_nameReal" Size="30,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_nameReal" ReadOnly="false" Size="50,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="uiChged" expr="1"/></OnEnChange></TextBox>
		<TAB/>
		<Label Text="移动电话*" Name="lb_mobile" Size="60,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_mobile" ReadOnly="false" Number="1" Size="80,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="ueChged" expr="1"/></OnEnChange></TextBox>
		<Button Text="查找" Name="search_m" Size="30,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{TB_mobile}">
			<DbDetails><where>where (user_Mobile='%{TB_mobile}' or user_Phone='%{TB_mobile}')</where></DbDetails><submit next="ContactList" namelist="DbDetails" method="post"/></if></OnClick></Button>
		<Button Text="呼叫" Name="dial0" OnClick="nis3ucs:%{TB_mobile}" Size="30,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="固定电话" Name="lb_phone" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_phone" ReadOnly="false" Number="1" Size="80,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="ueChged" expr="1"/></OnEnChange></TextBox>
		<Button Text="呼叫" Name="dial" OnClick="nis3ucs:%{TB_phone}" Size="30,20" Visible="true" Enabled="true"/>
		<BR Size="30,0"/>
		<Label Text="电邮*" Name="lb_email" Size="30,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_email" ReadOnly="false" Size="120,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="uiChged" expr="1"/></OnEnChange></TextBox>
		<TAB/>
		<Label Text="身份证或护照*" Name="lb_IDcard" Size="80,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_IDcard" ReadOnly="false" Size="120,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="ueChged" expr="1"/></OnEnChange></TextBox>
		<Button Text="查找" Name="search_id" Size="30,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{TB_IDcard}">
			<DbDetails><where>where (user_idcardno='%{TB_IDcard}')</where></DbDetails><submit next="ContactList" namelist="DbDetails" method="post"/></if></OnClick></Button>
		<TAB/>
		<Label Text="生日 " Name="lb_Birthday" Size="30,20" Visible="true" Enabled="true"/>
		<DateTime Text="20 years ago" Name="TB_Birthday" Size="80,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<TAB/>
		<Label Text="性别" Name="lb_Sex" Size="30,20" Visible="true" Enabled="true"/>
		<ComboBox Items=" |男|女" Name="CB_Sex" Size="50,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0"/>
		<BR Size="30,0"/>
		<Label Text="地址" Name="lb_addr" Size="30,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="init" Name="provinces" Size="100,200" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
			<queryFormat>select province_name,province_code from creator.ctu_province</queryFormat> 
			</DbDetails>
			
			<OnSELENDOK>
				<DbDetails>
				<queryFormat>select city_name,city_code from creator.ctu_city where city_province_code='%{provinces[province_code]}'</queryFormat> 
				</DbDetails>
				<submit next="citys" namelist="DbDetails" method="post"/>
				</OnSELENDOK>
			</ComboBox>
		<ComboBox Name="citys" Size="100,300" Visible="true" Enabled="true" Type="3" SelectedIndex="-1">
			<OnSELENDOK>
				<assign name="TB_addr" expr="%{provinces}%{citys}"/>
				</OnSELENDOK>
			</ComboBox>
		<TextBox Text="" Name="TB_addr" ReadOnly="false" Size="300,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="ueChged" expr="1"/></OnEnChange></TextBox>
		<TAB/>
		<BR Size="30,0"/>
		<Label Text="备注" Name="lb_remark" Size="30,20" Visible="true" Enabled="true"/>
		<TextBox Text="" tooltip="个人偏好" Name="TB_remark" ReadOnly="false" Size="600,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="uiChged" expr="1"/></OnEnChange></TextBox>

		<Button Location="680,30" Text="新增" ToolTip="新增客人信息以便办理入住" Name="insert" Size="30,20" Visible="true" Enabled="true">
			<OnClick>
			<if cond="!%{TB_nameReal}"><alert next="TB_nameReal" expr="%{lb_nameReal}不能为空"/>
			<elseif cond="!%{TB_mobile}"/><alert next="TB_mobile" expr="%{lb_mobile}不能为空"/>
			<elseif cond="!%{TB_email}"/><alert next="TB_email" expr="%{lb_email}不能为空"/>
			<elseif cond="!%{TB_IDcard}"/><alert next="TB_IDcard" expr="%{lb_IDcard}不能为空"/>
			<else/><assign name="newUser" expr="1"/><DbDetails><queryFormat>select InsertUser('%{TB_name}','','%{TB_email}','%{TB_nameReal}','%{TB_remark}','%{TB_mobile}','%{TB_phone}','%{TB_IDcard}','%{TB_addr}','%{TB_Birthday}',%{hostels.TB_code}) as code</queryFormat></DbDetails><submit next="TB_code" namelist="DbDetails" method="post"/>
			</if><assign name="uiChged" expr="0"/><assign name="ueChged" expr="0"/></OnClick></Button>
		<TAB/>
		<Button Text="修改" ToolTip="修改客人信息以便办理入住" Name="update" Size="30,20" Visible="true" Enabled="true">
			<OnClick>
			<assign name="uChged" expr="%{uiChged}+%{ueChged}"/>
			<if cond="!%{TB_nameReal}"><alert next="TB_nameReal" expr="%{lb_nameReal}不能为空"/>
			<elseif cond="!%{TB_code}"/><alert next="TB_code" expr="新资料请先'新增'"/>
			<elseif cond="!%{TB_mobile}"/><alert next="TB_mobile" expr="%{lb_mobile}不能为空"/>
			<elseif cond="!%{TB_email}"/><alert next="TB_email" expr="%{lb_email}不能为空"/>
			<elseif cond="!%{TB_IDcard}"/><alert next="TB_IDcard" expr="%{lb_IDcard}不能为空"/>
			<elseif cond="%{uChged}==0"/><alert next="TB_IDcard" expr="数据未做修改"/>
			<else/><if cond="%{uiChged}==1"><alert next="TB_nameReal" expr="uiChged %{uiChged}"/><DbDetails><queryFormat>update creator.ctu_user set user_email='%{TB_email}',user_login='%{TB_nameReal}',user_prefs='%{TB_remark}' where user_id=%{TB_code};</queryFormat></DbDetails><submit next="update" namelist="DbDetails" method="post"/></if>
			<if cond="%{ueChged}==1"><alert next="TB_nameReal" expr="ueChged %{ueChged}"/><DbDetails><queryFormat>update creator.ctu_user_extended set user_Mobile='%{TB_mobile}',user_Phone='%{TB_phone}',user_idcardno='%{TB_IDcard}',user_Address='%{TB_addr}',user_birthday='%{TB_Birthday}' where user_extended_id=%{TB_code};</queryFormat></DbDetails><submit next="update" namelist="DbDetails" method="post"/></if>
			</if><alert next="TB_IDcard" expr="uChged %{uChged}"/><assign name="uiChged" expr="0"/><assign name="ueChged" expr="0"/></OnClick></Button>
		<BR Size="680,25"/>
		<Button Text="清空数据" ToolTip="清空客人信息以便录入新的客人信息" Name="resetall" OnClick="SetText(TB_code,);SetText(TB_name,);SetText(TB_nameReal,);SetText(TB_mobile,);SetText(TB_phone,);SetText(TB_remark,);SetText(TB_email,);SetText(TB_addr,);SetText(TB_IDcard,);SetText(uiChged,0);SetText(ueChged,0);" Size="50,20" Visible="true" Enabled="true">
			</Button>
		<BR Size="680,25"/>
		<ListCtrl Heading="姓名,40;手机,40;" Name="ContactList" OnClick="SetText(newUser,0);SetText(TB_code,%{user_id});SetText(TB_name,%{user_loginname});SetText(TB_nameReal,%{user_login});SetText(TB_mobile,%{user_Mobile});SetText(TB_phone,%{user_Phone});SetText(TB_Birthday,%{user_birthday});SetText(TB_remark,%{user_prefs});SetText(TB_email,%{user_email});SetText(TB_addr,%{user_Address});SetText(TB_IDcard,%{user_idcardno});SetText(uiChged,0);SetText(ueChged,0);" Size="600,100" Visible="true" Enabled="true" PageSize="50">
			<DbDetails>
				<DbTable>creator.ctu_user as u left join creator.ctu_user_extended as e on u.user_id=e.user_extended_id</DbTable>
				<Index>user_id</Index>
				<Data>u.user_login,e.user_Mobile,e.user_idcardno,e.user_Phone,e.user_birthday,u.user_id,u.user_loginname,u.user_email,e.user_Address,u.user_prefs</Data>
				<Order>user_id</Order>
				<queryFormat>select %{data} from %{dbtable} %{where} order by %{order} limit %{StartRow},%{PgSize}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		</Ctrls></GroupBox>
		
		<BR autoHeight="1"/>
		<GroupBox Text="预留入住" Name="GroupBox2" Size="2,102" Visible="true" Enabled="true"><Ctrls>
		<Label Text="房间类型" Name="lb_roomTpye" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="init" Name="CB_roomTpye" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="-1">
			<DbDetails>
			<queryFormat>select roomtype,roomtypeid from creator.ctu_roomtype where hotel_id=%{hotelid}</queryFormat> 
			</DbDetails>
			<OnSELENDOK><if cond="%{CB_roomTpye}">
				<DbDetails/><submit next="CB_roomAvlb" namelist="DbDetails" method="post"/>
				<else/><submit next="CB_roomAvlb" method="post" function="resetcontent"/></if>
				</OnSELENDOK>
				</ComboBox>
		<DateTime Name="DtStart" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<DateTime Text="1 day" Name="DtEnd" Size="100,20" Visible="true" Enabled="true" Format="yyyy-MM-dd"/>
		<Button Text="预留" ToolTip="门店预定或散客直接前来入住需先预留占用相应房型，若已知客人信息可先选择录入或直接选取客人信息，然后选择房型、入住日期、退房日期点击本按钮，若操作成功表示有可以办理，否则不能办理或做协调" Name="insertR" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><assign name="break" expr="0"/><if cond="!%{CB_roomTpye[roomtypeid]}"><alert next="insertR" expr="请选择%{lb_roomTpye}"/><assign name="break" expr="1"/></if>
			<if cond="%{DtStart} &gt;= %{DtEnd}"><alert next="insertR" expr="请选择有效时间段"/><assign name="break" expr="1"/></if>
			<if cond="!%{break}"><DbDetails/><submit next="TB_noroomAvail" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		<TextBox Text="" Name="TB_noroomAvail" ReadOnly="false" Size="50,20" Visible="false" Enabled="true">
			<DbDetails><queryFormat>select cast(sum(case when (numTotal-numReserved-numBooking+numCanceled)>0 then 0 else 1 end ) as SIGNED) as numAv,roomtp_id from creator.ctu_roomrates where dt &gt;= UNIX_TIMESTAMP('%{DtStart}') and dt &lt; UNIX_TIMESTAMP('%{DtEnd}') and roomtp_id=%{CB_roomTpye[roomtypeid]} group by roomtp_id</queryFormat></DbDetails>
			<OnEnChange><if cond="%{TB_noroomAvail}==0">
			<DbDetails><queryFormat>insert into creator.ctu_reservation (hotel_id, src,checkindate,checkoutdate,roomtypeid,roomtypename,guestid,custName,custDemand,status,confirmed_date,confirmed_by,reserved_date,billTotal) values(%{hostels.TB_code},'3',UNIX_TIMESTAMP('%{DtStart}'),UNIX_TIMESTAMP('%{DtEnd}'),%{CB_roomTpye[roomtypeid]},'%{CB_roomTpye[roomtype]}','%{TB_code}','%{TB_nameReal}','%{TB_demand}',7,UNIX_TIMESTAMP(),'%{user_id}',UNIX_TIMESTAMP(),'%{TB_billTotal}')</queryFormat></DbDetails>
			<submit next="insertR" namelist="DbDetails" method="post"/><submit next="search" method="post" function="click"/>
			<elseif cond="%{TB_noroomAvail}==1"/><alert next="insertR" expr="该房型已满，不能预留！"/></if><assign name="TB_noroomAvail" expr=""/></OnEnChange></TextBox>
		<TextBox Text="" Name="TB_code_resv" ReadOnly="false" Size="30,20" Visible="false" Enabled="false">
				<OnEnChange><if cond="%{TB_code_resv}"><DbDetails/><submit next="billdetail" namelist="DbDetails"/>
				<else/><submit next="billdetail" method="post" function="resetcontent"/></if>
				</OnEnChange></TextBox>
		<Button Text="刷新" Name="search" Size="60,20" Visible="true" Enabled="true">
			<OnClick><DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
		<Label Text="客人要求" Name="lb_demand" Size="50,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_demand" ReadOnly="false" Size="500,20" Visible="true" Enabled="true"/>
		<BR/>
		<ListCtrl Heading="房型,50;客人姓名,20;电话,80;邮件,80;订单总价,80;预留时间,80;预计入住,80;预计退房,80;状态,80;房号,80;天数,80;房价明细,100" Name="rmtplst" Size="600,300" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_reservation</DbTable>
				<Data>roomtypename,custName,phone,custEmail,billTotal,FROM_UNIXTIME(reserved_date,'%Y-%m-%d %H:%i') as reserved_dt,FROM_UNIXTIME(checkindate,'%Y-%m-%d') as checkin, FROM_UNIXTIME(checkoutdate,'%Y-%m-%d') as checkout, getResvStatusName(status) as statusName,roomno,(checkoutdate-checkindate)/86400 as days,billDetail, agentid,reservation_id,guestid,book_id,roomtypeid, confirmed_by,confirmed_date,getPayStatusName(payStaus) as payStatus,custDemand,status,src</Data>
				<Order>order by reservation_id</Order>
				<Where>and checkindate between UNIX_TIMESTAMP('%{DtStart}') and UNIX_TIMESTAMP('%{DtEnd}') and status=7</Where>
				<queryFormat>select %{data} from %{dbtable} where hotel_id=%{hotelid} %{where} %{order}</queryFormat> 
			</DbDetails>
			<OnClick>
				<assign name="TB_code_resv" function="SetText" expr="%{rmtplst[reservation_id]}"/>
				<assign name="DtStart" function="SetValue" expr="%{rmtplst[checkin]}"/>
				<assign name="DtEnd" function="SetValue" expr="%{rmtplst[checkout]}"/>
				<assign name="TB_demand" function="SetText" expr="%{rmtplst[custDemand]}"/>
				<assign name="CB_roomTpye" function="SetSel" expr="%{rmtplst[roomtypename]}"/>
			</OnClick>
		</ListCtrl>
		<TAB/><GroupBox Text="查询" Name="GBSearchs" Visible="true" Enabled="true"><Ctrls>
		<Label Text="可用房间" Name="lb_roomno" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_roomAvlb" Size="60,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
			<queryFormat>select roomno,roomid,getRoomPrice(%{CB_roomTpye[roomtypeid]},CURDATE()) as price,description from creator.ctu_rooms where roomtypeid=%{CB_roomTpye[roomtypeid]} and roomstatus=1</queryFormat> 
			</DbDetails>
			<OnSELENDOK>
			<assign name="TB_desc" expr="%{CB_roomAvlb[description]}"/>
			<assign name="TB_price" expr="%{CB_roomAvlb[price]}"/>
				</OnSELENDOK>
			</ComboBox>
		<BR/>
		<TextBox Text="房间信息" Name="TB_desc" ReadOnly="true" Size="100,50" Visible="true" Enabled="true"/>
		<BR autoheight="1"/>
		<TextBox ToolTip="门市价" Name="TB_price" ReadOnly="true" Size="60,20" Visible="true" Enabled="true">
			<OnEnChange><if cond="%{TB_price}"><DbDetails/><submit next="TB_billTotal" namelist="DbDetails" method="post"/>
			<else/><assign name="TB_billTotal" expr=""/></if>
				</OnEnChange></TextBox>
		<TextBox ToolTip="总价" Name="TB_billTotal" ReadOnly="true" Size="60,20" Visible="true" Enabled="true">
		<DbDetails>
			<queryFormat>select sum(getRoomPriceU(%{CB_roomTpye[roomtypeid]},dt)) from (select distinct(dt) from creator.ctu_roomrates where dt between UNIX_TIMESTAMP('%{DtStart}') and UNIX_TIMESTAMP('%{DtEnd}')-1) as q</queryFormat> 
			</DbDetails></TextBox>
		<BR/>
		<TextBox tooltip="入住押金" Name="TB_deposit" ReadOnly="false" Number="1" Size="60,20" Visible="true" Enabled="true"/>
		<Button Text="预收押金" ToolTip="若客人办理入住需收取押金，在“入住押金”输入相应金额后“预收押金”。" Name="deposit" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="!%{TB_deposit}"><alert next="deposit" expr="押金不能为空"/>
			<elseif cond="!%{TB_code}"/><alert next="deposit" expr="客人信息不正确"/>
			<elseif cond="!%{rmtplst[reservation_id]}"/><alert next="deposit" expr="订单信息不正确"/>
			<else/><DbDetails><queryFormat>insert into creator.ctu_billdetails (itemid, user_id, resvation_id, hotel_id, expense, itype, created_by, created_dt) values(16,'%{TB_code}','%{rmtplst[reservation_id]}',%{hostels.TB_code},%{TB_deposit}*100,0,'%{user_id}',UNIX_TIMESTAMP())</queryFormat></DbDetails><submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="billdetail" namelist="DbDetails"/></if></OnClick></Button>
 		<BR/><ListCtrl Heading="类别,80;金额,80;时间,80;操作员,80" Name="billdetail" Size="120,80" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_billdetails as b inner join creator.ctu_user as u on b.created_by=u.user_id inner join creator.ctu_billtypes as t on t.itemid=b.itemid</DbTable>
				<Data>itemCN,expense/100,FROM_UNIXTIME(created_dt,'%Y-%m-%d %H:%i') as dt,user_loginname</Data>
				<Order>order by dt</Order>
				<queryFormat>select %{data} from %{dbtable} where resvation_id='%{TB_code_resv}' %{where} %{order}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		<BR autoheight="1"/>
		<Button Text="办理入住" ToolTip="根据所选订单选择可用房间方可办理入住。" Name="insertbookin" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><assign name="break" expr="0"/><if cond="!%{TB_code}"><alert next="TB_code" expr="请先保存客人信息"/><assign name="break" expr="1"/></if>
			<if cond="%{rmtplst[status]}!=7"><alert next="CB_roomAvlb" expr="非预定状态订单不能办理入住"/><assign name="break" expr="1"/></if>
			<if cond="!%{CB_roomAvlb[roomid]}"><alert next="CB_roomAvlb" expr="%{lb_roomno}不能为空"/><assign name="break" expr="1"/></if>
			<if cond="!%{break}"><if cond="!%{rmtplst[guestid]}"><DbDetails><queryFormat>update creator.ctu_reservation set guestid=%{TB_code},custName='%{TB_nameReal}',phone='%{TB_mobile}',custEmail='%{TB_email}',billTotal=%{TB_billTotal} where reservation_id=%{rmtplst[reservation_id]}</queryFormat></DbDetails><submit next="insertbookin" namelist="DbDetails" method="post"/></if>
			<if cond="!%{rmtplst[billTotal]}"><DbDetails><queryFormat>update creator.ctu_reservation set billTotal=%{TB_billTotal} where reservation_id=%{rmtplst[reservation_id]}</queryFormat></DbDetails><submit next="insertbookin" namelist="DbDetails" method="post"/></if>
			<DbDetails><queryFormat>insert into creator.ctu_bookin (hotel_id, roomid,roomNo, roomtypeid,roomType,reservation_id,guestid,custName,checkindate,checkoutdate,checkedin_date,checkedin_by) values(%{hostels.TB_code},'%{CB_roomAvlb[roomid]}','%{CB_roomAvlb[roomno]}',%{CB_roomTpye[roomtypeid]},'%{CB_roomTpye[roomtype]}','%{rmtplst[reservation_id]}',%{TB_code},'%{TB_nameReal}',UNIX_TIMESTAMP('%{rmtplst[checkin]}'),UNIX_TIMESTAMP('%{rmtplst[checkout]}'),UNIX_TIMESTAMP(),'%{user_id}')</queryFormat></DbDetails><submit next="insertbookin" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/><submit next="CB_roomAvlb" method="post" function="resetcontent"/>
			</if></OnClick></Button>
		<TAB/><Button Text="置取消" ToolTip="该操作将改变所选订单为取消状态。" Name="canceled" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="%{rmtplst[status]}==7">
			<DbDetails><queryFormat>update creator.ctu_reservation set status=2 where reservation_id='%{rmtplst[reservation_id]}'</queryFormat></DbDetails><submit next="canceled" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="rmtplst" namelist="DbDetails" method="post"/>
			</if></OnClick></Button></Ctrls></GroupBox>
		</Ctrls></GroupBox>
	</Ctrls>      
	<OnChanged><if cond="%{users.TB_code[IsDataChanged]}>0"><if cond="%{users.TB_code[SnapShot]}"><notify next="tst" expr="code %{users.TB_code[SnapShot]}"/></if></if>
		</OnChanged>
	<OnActivate>
		<if cond="'%{session.hotel_id}'&&(%{hotelid}!=%{session.hotel_id})">
			<assign name="hotelid" expr="%{session.hotel_id}"/>
			<submit next="CB_roomTpye"/><submit next="rmtplst"/></if>
		<if cond="%{rmtpChg}!=%{roomtype.ChangeId}">
			<assign name="rmtpChg" expr="%{roomtype.ChangeId}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<submit next="search" method="post" function="click"/></OnActivate>
	</WndTap>
		<WndTap xml:base="d:\Program Files (x86)\3UCS\3UCS Server\layout\ucin\centyou\users.xml" Text="用户管理" Name="users">
	<var name="uiChged" expr="0"/>
	<var name="ueChged" expr="0"/>
	<var name="purviewcond" expr=""/>
	<var name="hotelonly" expr=""/>
	<var name="hotelonlys" expr=""/>
	<Ctrls>
		<GroupBox Text="用户权限管理" Name="GroupBox2" Size="750,100" Visible="true" Enabled="true"><Ctrls>
		<Label Text="用户名" Name="lb_user" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox OnLoad="init" Name="CB_user" Size="100,200" Visible="true" Enabled="true" Type="3" SelectedIndex="0">
			<DbDetails>
			<queryFormat>select user_loginname,user_id,user_login,user_email from creator.ctu_user %{where} limit 0,20</queryFormat> 
			</DbDetails>
			<OnSELENDOK>
				<assign name="TB_realname" expr="%{CB_user[user_login]}"/>
				<assign name="TB_email" expr="%{CB_user[user_email]}"/>
				</OnSELENDOK>
			</ComboBox>
		<TextBox Text="" tooltip="搜索前缀" Name="TB_userprefix" ReadOnly="false" Size="50,20" Visible="true" Enabled="true"/>
		<Button Text="搜索用户" tooltip="在搜索前缀框（前面的文本框）里输入要搜索的用户名的前面部分，点击搜索，结果将显示在用户列表中" Name="searchUser" Size="60,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where> where user_loginname like '%{TB_userprefix}%'</Where></DbDetails><submit next="CB_user" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<TextBox Text="" tooltip="真实姓名" Name="TB_realname" ReadOnly="true" Size="80,20" Visible="true" Enabled="true"/>
		<TextBox Text="" tooltip="电子邮件" Name="TB_email" ReadOnly="true" Size="120,20" Visible="true" Enabled="true"/>
		<ComboBox Items="禁用|启用" Name="CB_bizStatus" Size="60,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0"/>
		<Button Text="新增用户" tooltip="新增该用户为响应的角色并拥有相应权限" Name="insertR" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="!%{CB_user[user_id]}"><alert next="insertR" expr="请选择%{lb_user}"/><assign name="break" expr="1"/></if>
			<if cond="%{purview}!=127"><if cond="!%{CB_hotel[hotel_id]}"><alert next="insertR" expr="请选择%{lb_hotel}"/><assign name="break" expr="1"/></if></if>
			<if cond="!%{break}"><DbDetails>
			<Data>(user_id, hotel_id, role_id, biz_status, create_dt, create_by)</Data>
			<queryFormat>insert into creator.ctu_biz %{data} values('%{CB_user[user_id]}','%{CB_hotel[hotel_id]}','%{CB_role[role_id]}','%{CB_bizStatus[SelectedIndex]}',UNIX_TIMESTAMP(),'%{user_id}')</queryFormat></DbDetails>
			<submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="userlst" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		<Button Text="修改用户" tooltip="禁用该用户或取消现有用户的角色及权限并设置新的权限给新的选择的用户" Name="updateR" Clickneedconfirm="true" Size="50,20" Visible="true" Enabled="true">
			<OnClick><if cond="!%{CB_user[user_id]}"><alert next="insertR" expr="请选择%{lb_user}"/><assign name="break" expr="1"/></if>
			<if cond="!%{break}"><DbDetails>
			<queryFormat>update creator.ctu_biz set user_id='%{CB_user[user_id]}',hotel_id='%{CB_hotel[hotel_id]}',role_id='%{CB_role[role_id]}',biz_status='%{CB_bizStatus[SelectedIndex]}',update_dt=UNIX_TIMESTAMP(),update_by='%{user_id}' where biz_id=%{userlst[biz_id]}</queryFormat></DbDetails>
			<submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="userlst" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		
		<BR/><Label Text="门店名" Name="lb_hotel" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_hotel" Size="150,200" Visible="true" Enabled="true" Type="3" SelectedIndex="-1">
			<DbDetails>
			<queryFormat>select HotelName,hotel_id,manager from creator.ctu_hotels %{hotelonlys} %{where} limit 0,20</queryFormat> 
			</DbDetails>
			<OnSELENDOK>
				<assign name="TB_HotelManager" expr="%{CB_hotel[manager]}"/>
				</OnSELENDOK>
			</ComboBox>
		<TextBox Text="" tooltip="搜索前缀" Name="TB_hotelprefix" ReadOnly="false" Size="50,20" Visible="true" Enabled="true"/>
		<Button Text="搜索门店" tooltip="在搜索前缀框（前面的文本框）里输入要搜索的门店的前面部分，点击搜索，结果将显示在门店列表中" Name="searchHotel" Size="60,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where> where HotelName like '%{TB_hotelprefix}%'</Where></DbDetails><submit next="CB_hotel" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<TextBox Text="" tooltip="门店经理" Name="TB_HotelManager" ReadOnly="true" Size="80,20" Visible="true" Enabled="true"/>
		<ComboBox Name="CB_role" Size="80,200" Visible="true" Enabled="true" Type="3" SelectedIndex="-1">
			<DbDetails>
			<queryFormat>select name,role_id,grouptype from creator.ctu_bizrole %{purviewcond} </queryFormat> 
			</DbDetails>
			<OnSELENDOK>
				<assign name="TB_rolegrouptype" expr="%{CB_role[grouptype]}"/>
				</OnSELENDOK>
			</ComboBox>
		<TextBox Text="" tooltip="角色组别" Name="TB_rolegrouptype" ReadOnly="true" Size="50,20" Visible="true" Enabled="false"/>
		<Button Text="门店总负责" tooltip="设置该用户为该门店的所有者" Name="SetHotelManager" Clickneedconfirm="true" Size="60,20" Visible="true" Enabled="true">
			<OnClick><if cond="!%{CB_user[user_id]}"><alert next="SetHotelManager" expr="请选择%{lb_user}"/><assign name="break" expr="1"/></if>
			<if cond="!%{CB_hotel[hotel_id]}"><alert next="SetHotelManager" expr="请选择%{lb_hotel}"/><assign name="break" expr="1"/></if>
			<if cond="!%{break}"><DbDetails>
			<queryFormat>update creator.ctu_hotels set manager_id=%{CB_user[user_id]},manager='%{CB_user[user_login]}' where hotel_id=%{CB_hotel[hotel_id]}</queryFormat></DbDetails>
			<submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="CB_hotel" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		<Button Text="查找" tooltip="当门店列表有选择时搜索该门店的相关用户角色，当列表为空时搜索当前使用者相关权限门店的相关用户角色" Name="search" Size="60,20" Visible="true" Enabled="true">
			<OnClick><assign name="srhuh" expr=""/><if cond="%{CB_hotel[hotel_id]}"><assign name="srhuh" expr="and b.hotel_id='%{CB_hotel[hotel_id]}'"/></if><DbDetails><Where>%{srhuh}</Where></DbDetails><submit next="userlst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<Button Text="查找该用户" tooltip="该用户所有用户角色" Name="searchRU" Size="60,20" Visible="true" Enabled="true">
			<OnClick><DbDetails><Where>and b.user_id='%{CB_user[user_id]}'</Where></DbDetails><submit next="userlst" namelist="DbDetails" method="post"/></OnClick>
			</Button>
		<BR/>
		<ListCtrl Heading="用户名,50;酒店名,20;角色,80;状态,80;创建时间,80;创建人,80;更新时间,80;更新人,80" Name="userlst" OnClick="SetSel(CB_user,%{user_loginname});SetSel(CB_hotel,%{HotelName});SetSel(CB_role,%{name});SetSel(CB_bizStatus,%{biz_status});" Size="600,300" Visible="true" Enabled="true">
			<DbDetails>
				<DbTable>creator.ctu_biz as b left join creator.ctu_user as u on b.user_id=u.user_id left join creator.ctu_hotels as h on b.hotel_id=h.hotel_id left join creator.ctu_bizrole as r on b.role_id=r.role_id</DbTable>
				<Data>u.user_loginname, h.HotelName, r.name, b.biz_status, FROM_UNIXTIME(b.create_dt,'%Y-%m-%d') as crdt, b.create_by, FROM_UNIXTIME(b.update_dt,'%Y-%m-%d') as updt,b.update_by, b.biz_id</Data>
				<Order>order by biz_id</Order>
				<Where/>
				<queryFormat>select %{data} from %{dbtable} %{purviewcond} %{where} %{hotelonly}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		</Ctrls></GroupBox>

		<BR autoHeight="1"/>
		<GroupBox Text="角色管理" Name="GroupBox1" Size="750,100" Visible="true" Enabled="true"><Ctrls>
		<Label Text="角色名" Name="lb_name" Size="40,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_name" ReadOnly="false" Size="80,20" Visible="true" Enabled="true"/>
		<TAB/>
		<Label Text="角色主页" Name="lb_layout" Size="60,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_layout" ReadOnly="false" Size="100,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="uiChged" expr="1"/></OnEnChange></TextBox>
		<TAB/>
		<Label Text="权限" Name="lb_purview" Size="30,20" Visible="true" Enabled="true"/>
		<TextBox Text="" Name="TB_purview" ReadOnly="false" Number="1" Size="80,20" Visible="true" Enabled="true">
		<OnEnChange><assign name="ueChged" expr="1"/></OnEnChange></TextBox>
		<TAB/>
		<Label Text="部门类别" Name="lb_grouptype" Size="50,20" Visible="true" Enabled="true"/>
		<ComboBox Items=" |总部|门店" Name="CB_grouptype" Size="100,100" Visible="true" Enabled="true" Type="3" SelectedIndex="0"/>
		<TextBox Text="" Name="TB_code" ReadOnly="false" NULLChanged="1" Size="20,20" Visible="0" Enabled="true"> 
			<DbDetails>
				<DbTable>creator.ctu_bizrole</DbTable>
				<Index>user_id</Index>
				<Data>role_id</Data>
				<Order>role_id desc</Order>
				<queryFormat>select %{data} from %{dbtable} %{where} order by %{order} limit 0,1</queryFormat> 
			</DbDetails>
			</TextBox>

		<BR/>
		<ListCtrl Heading="序号,40;角色名,40;主页,100;权限,20;组别,40;" OnLoad="init" Name="ContactList" OnClick="SetText(TB_code,%{role_id});SetText(TB_name,%{name});SetText(TB_layout,%{biz_layout});SetText(TB_purview,%{purview});SetSel(CB_grouptype,%{grouptype});" Size="300,100" Visible="true" Enabled="true" PageSize="50">
			<DbDetails>
				<DbTable>creator.ctu_bizrole</DbTable>
				<Index>user_id</Index>
				<Data>role_id,name,biz_layout,purview,grouptype</Data>
				<Order>role_id</Order>
				<queryFormat>select %{data} from %{dbtable} %{where} order by %{order} limit %{StartRow},%{PgSize}</queryFormat> 
			</DbDetails>
		</ListCtrl>
		<Button Text="查找" Name="search_m" Size="30,20" Visible="true" Enabled="true">
			<OnClick>
			<DbDetails/><submit next="ContactList" namelist="DbDetails" method="post"/></OnClick></Button>
		<Button Text="新增" Name="insert" Size="30,20" Visible="true" Enabled="true">
			<OnClick>
			<if cond="!%{TB_name}"><alert next="TB_name" expr="%{lb_name}不能为空"/>
			<elseif cond="!%{TB_layout}"/><alert next="TB_layout" expr="%{lb_layout}不能为空"/>
			<elseif cond="!%{TB_purview}"/><alert next="TB_purview" expr="%{lb_purview}不能为空"/>
			<else/><assign name="newRole" expr="1"/>
			<DbDetails>
			<Data>(name,biz_layout,purview,grouptype)</Data>
			<queryFormat>insert into creator.ctu_bizrole %{data} values('%{TB_name}','%{TB_layout}','%{TB_purview}','%{CB_grouptype}')</queryFormat></DbDetails>
			<submit namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="TB_code" namelist="DbDetails" method="post"/>
			<submit next="ContactList" namelist="DbDetails" method="post"/>
			<submit next="CB_role" namelist="DbDetails" method="post"/>
			</if><assign name="uiChged" expr="0"/><assign name="ueChged" expr="0"/></OnClick></Button>
		<TAB/>
		<Button Text="修改" Name="update" Size="30,20" Visible="true" Enabled="true">
			<OnClick>
			<assign name="uChged" expr="%{uiChged}+%{ueChged}"/>
			<if cond="!%{TB_name}"><alert next="TB_name" expr="%{lb_name}不能为空"/>
			<elseif cond="!%{TB_layout}"/><alert next="TB_layout" expr="%{lb_layout}不能为空"/>
			<elseif cond="!%{TB_purview}"/><alert next="TB_purview" expr="%{lb_purview}不能为空"/>
			<else/><DbDetails><queryFormat>update creator.ctu_bizrole set name='%{TB_name}',biz_layout='%{TB_layout}',purview='%{TB_purview}',grouptype='%{CB_grouptype}' where role_id=%{TB_code};</queryFormat></DbDetails>
			<submit next="update" namelist="DbDetails" method="post"/>
			<DbDetails/><submit next="ContactList" namelist="DbDetails" method="post"/><submit next="CB_role" namelist="DbDetails" method="post"/>
			</if></OnClick></Button>
		</Ctrls></GroupBox>
		
	</Ctrls>      
	<OnChanged><if cond="%{users.TB_code[IsDataChanged]}>0"><if cond="%{users.TB_code[SnapShot]}"><notify next="tst" expr="code %{users.TB_code[SnapShot]}"/></if></if>
		</OnChanged>
	<OnActivate>
		<if cond="%{purview}"><assign name="purviewcond" expr="where purview &lt;= %{purview}"/></if>
		<if cond="%{purview}!=127"><SetVisible name="GroupBox1" Visible="0"/><SetVisible name="SetHotelManager" Visible="0"/><SetVisible name="searchHotel" Visible="0"/><assign name="hotelonlys" expr="where manager_id = %{user_id}"/></if>
		<if cond="%{hotel_id}"><assign name="hotelonly" expr="and b.hotel_id = %{hotel_id}"/></if>
		<if cond="%{hotelid}!=%{hostels.TB_code}">
			<assign name="hotelid" expr="%{hostels.TB_code}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<if cond="%{rmtpChg}!=%{roomtype.ChangeId}">
			<assign name="rmtpChg" expr="%{roomtype.ChangeId}"/>
			<DbDetails/><submit next="CB_roomTpye" namelist="DbDetails"/></if>
		<submit next="search" method="post" function="click"/>
		<DbDetails/><submit next="CB_role" namelist="DbDetails"/>
		<submit next="userlst" namelist="DbDetails" method="post"/>
		<submit next="CB_hotel" namelist="DbDetails" method="post"/>
		</OnActivate>
	</WndTap>
	</WndTaps>
</XI3uWnd>